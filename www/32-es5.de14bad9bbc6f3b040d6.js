function _createForOfIteratorHelper(e,o){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||o&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,c=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return c=e.done,e},e:function(e){s=!0,t=e},f:function(){try{c||null==i.return||i.return()}finally{if(s)throw t}}}}function _unsupportedIterableToArray(e,o){if(e){if("string"==typeof e)return _arrayLikeToArray(e,o);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,o):void 0}}function _arrayLikeToArray(e,o){(null==o||o>e.length)&&(o=e.length);for(var i=0,n=new Array(o);i<o;i++)n[i]=e[i];return n}function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,o,i){return o&&_defineProperties(e.prototype,o),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{"2HF3":function(e,o,i){"use strict";i.r(o),i.d(o,"ProgramarVisitaPageModule",(function(){return S}));var n=i("ofXK"),r=i("3Pt+"),t=i("TEn/"),c=i("tyNb"),s=i("mrSG"),a=i("wd/R"),l=i("fXoL"),u=i("89nv"),d=i("u//c");function b(e,o){if(1&e&&(l.Ob(0,"ion-select-option",13),l.kc(1),l.Nb()),2&e){var i=o.$implicit;l.ec("value",i.id_cliente),l.zb(1),l.lc(i.razon_social_cliente)}}function p(e,o){if(1&e&&(l.Ob(0,"ion-select-option",13),l.kc(1),l.Nb()),2&e){var i=o.$implicit;l.ec("value",i.id_sucursal),l.zb(1),l.lc(i.razon_social_sucursal)}}function _(e,o){if(1&e&&(l.Ob(0,"ion-select-option",13),l.kc(1),l.Nb()),2&e){var i=o.$implicit;l.ec("value",i.id_servicio),l.zb(1),l.lc(i.nombre_servicio)}}function g(e,o){if(1&e&&(l.Ob(0,"ion-select-option",13),l.kc(1),l.Nb()),2&e){var i=o.$implicit;l.ec("value",i.id_tecnico),l.zb(1),l.nc("",i.nombre_tecnico," ",i.apellido_tecnico,"")}}function f(e,o){if(1&e){var i=l.Pb();l.Ob(0,"div"),l.Ob(1,"ion-label",16),l.kc(2),l.Nb(),l.Ob(3,"ion-item",17),l.Ob(4,"ion-label",1),l.kc(5,"Seleccionar t\xe9cnico a cargo"),l.Nb(),l.Ob(6,"ion-select",18),l.Wb("ngModelChange",(function(e){return l.gc(i),o.$implicit.tecnico=e})),l.jc(7,g,2,3,"ion-select-option",3),l.Nb(),l.Nb(),l.Nb()}if(2&e){var n=o.$implicit,r=l.Yb(2);l.zb(2),l.lc(n.nombre_equipo),l.zb(4),l.dc("interfaceOptions",r.custom)("ngModel",n.tecnico),l.zb(1),l.dc("ngForOf",r.listado_tecnicos)}}function v(e,o){if(1&e&&(l.Ob(0,"div",14),l.Ob(1,"h2",14),l.kc(2),l.Nb(),l.jc(3,f,8,4,"div",15),l.Nb()),2&e){var i=o.$implicit;l.zb(2),l.lc(i.nombre_servicio),l.zb(1),l.dc("ngForOf",i.equipos)}}function h(e,o){if(1&e&&(l.Ob(0,"p"),l.kc(1),l.Nb()),2&e){var i=o.$implicit;l.zb(1),l.mc("",i.nombre_tecnico,", ")}}function m(e,o){if(1&e&&(l.Ob(0,"ion-col",24),l.kc(1),l.Nb()),2&e){var i=o.$implicit,n=l.Yb().$implicit;l.dc("size",3/n.tecnico.length),l.zb(1),l.mc(" ",i.nombre_tecnico," ")}}function q(e,o){if(1&e){var i=l.Pb();l.Ob(0,"ion-col",29),l.Ob(1,"ion-checkbox",30),l.Wb("click",(function(){l.gc(i);var e=o.index,n=l.Yb().index,r=l.Yb(),t=r.$implicit,c=r.index;return l.Yb(2).prueba(t,e,c,n)}))("ngModelChange",(function(e){l.gc(i);var n=o.$implicit,r=l.Yb().index,t=l.Yb().index;return n.equipos[t][r].selected=e})),l.Nb(),l.Nb()}if(2&e){var n=o.$implicit,r=l.Yb().index,t=l.Yb(),c=t.$implicit,s=t.index;l.dc("size",3/c.tecnico.length),l.zb(1),l.dc("ngModel",n.equipos[s][r].selected)("checked",1==c.tecnico.length)}}function O(e,o){if(1&e&&(l.Ob(0,"div",25),l.Ob(1,"ion-row"),l.Ob(2,"ion-col",26),l.Ob(3,"ion-label",27),l.kc(4),l.Nb(),l.Nb(),l.jc(5,q,2,3,"ion-col",28),l.Nb(),l.Nb()),2&e){var i=o.$implicit,n=l.Yb().$implicit;l.zb(4),l.nc("",i.nombre_equipo,": ",i.nombre_servicio,""),l.zb(1),l.dc("ngForOf",n.tecnico)}}function y(e,o){if(1&e){var i=l.Pb();l.Ob(0,"div",14),l.Ob(1,"h2",14),l.kc(2),l.Nb(),l.Ob(3,"ion-item",19),l.Wb("click",(function(){l.gc(i);var e=o.$implicit,n=o.index;return l.Yb(2).presentAlertCheckbox(e,n,e.tecnico)})),l.Ob(4,"ion-label",1),l.kc(5,"Seleccionar t\xe9cnicos a cargo"),l.Nb(),l.jc(6,h,2,1,"p",15),l.Nb(),l.Ob(7,"div"),l.Ob(8,"ion-row"),l.Ob(9,"ion-col",20),l.Ob(10,"ion-label",21),l.kc(11,"Equipo"),l.Nb(),l.Nb(),l.jc(12,m,2,2,"ion-col",22),l.Nb(),l.Nb(),l.jc(13,O,6,3,"div",23),l.Nb()}if(2&e){var n=o.$implicit;l.zb(2),l.lc(n.nombre_equipo_grupo),l.zb(4),l.dc("ngForOf",n.tecnico),l.zb(6),l.dc("ngForOf",n.tecnico),l.zb(1),l.dc("ngForOf",n.equipos)}}function C(e,o){if(1&e&&(l.Ob(0,"div"),l.jc(1,y,14,4,"div",6),l.Nb()),2&e){var i=l.Yb();l.zb(1),l.dc("ngForOf",i.grupoWorkStationElegidos)}}var k,w,N,x=[{path:"",component:(k=function(){function e(o,i,n){_classCallCheck(this,e),this.api=o,this.api_tecnicos=i,this.alertController=n,this.serviciosConEquipos=[],this.serviciosElegidos=[],this.serviciosParaEnviar=[],this.grupoWorkStation=[],this.grupoWorkStationElegidos=[],this.show=!1,this.servicios_elegidosAux=[],this.id_cliente_elegido=null,this.sucursal_elegida=null,this.equiposCargados=!1,this.workStationCargados=!1,this.dayNames=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],this.monthNames=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],this.custom={cssClass:"alertSize"}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;console.warn(1),this.api.mostrar_servicios().subscribe((function(o){console.warn(2),e.listado_servicios=o,e.listado_servicios=e.listado_servicios.result,console.log(e.listado_servicios,"servicios")})),this.api.listado_clientes().subscribe((function(o){e.listado_clientes=o,e.listado_clientes=e.listado_clientes.result,e.listado_clientes.sort(e.ordenarClientes),console.log(e.listado_clientes)})),this.api_tecnicos.listado_tecnicos().subscribe((function(o){e.listado_tecnicos=o,e.listado_tecnicos=e.listado_tecnicos.result,e.listado_tecnicos.sort(e.ordenarTecnicos),console.log(e.listado_tecnicos)}),(function(e){console.log(e)})),this.fecha_actual=a().format()}},{key:"sucursalesCliente",value:function(e){var o=this;this.api.informacion_cliente(e).subscribe((function(i){o.listado_sucursales_cliente=i,console.log(i),o.listado_sucursales_cliente=o.listado_sucursales_cliente.result.sucursales.datosSucursal,o.sucursal_elegida=null,o.id_cliente_elegido=e,o.listado_sucursales_cliente.sort(o.ordenarSucursales),console.log(o.listado_sucursales_cliente)}))}},{key:"selectSucursal",value:function(){var e=this;null!=this.sucursal_elegida&&this.api.listado_equipos_id(this.sucursal_elegida).subscribe((function(o){e.equipos=o.result,console.log(e.equipos,"equipos");var i,n=_createForOfIteratorHelper(e.listado_servicios);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.equipos=[];var t,c=_createForOfIteratorHelper(e.equipos);try{for(c.s();!(t=c.n()).done;){var s=t.value;s.id_servicio==r.id_servicio&&r.equipos.push(s)}}catch(a){c.e(a)}finally{c.f()}r.equipos.length<1&&r.equipos.push({id_equipo:0,id_servicio:r.id_servicio,nombre_equipo:"Servicio principal"})}}catch(a){n.e(a)}finally{n.f()}console.log(e.listado_servicios,"servicios completos"),e.equiposCargados=!0})),this.api.listado_grupoWorkstations(this.sucursal_elegida).subscribe((function(o){var i=0,n=[],r=0,t=!0;"error"==o.status?alert("Ocurrio un error: "+o.message):(o.result.forEach((function(e){e.id_equipo_grupo==i?n[r].equipos.push({id_equipo:e.id_equipo,id_servicio:e.id_servicio,id_sucursal:e.id_sucursal,nombre_equipo:e.nombre_equipo,codigo_qr_equipo:e.codigo_qr_equipo,estado_servicio:e.estado_servicio,nombre_servicio:e.nombre_servicio,qr:e.qr}):(t||r++,i=e.id_equipo_grupo,n.push({nombre_equipo_grupo:e.nombre_equipo_grupo,id_equipo_grupo:e.id_equipo_grupo,equipos:[]}),n[r].equipos.push({id_equipo:e.id_equipo,id_servicio:e.id_servicio,id_sucursal:e.id_sucursal,nombre_equipo:e.nombre_equipo,codigo_qr_equipo:e.codigo_qr_equipo,estado_servicio:e.estado_servicio,nombre_servicio:e.nombre_servicio,qr:e.qr}),t=!1)})),e.grupoWorkStation=n),console.log("grupo2: ",e.grupoWorkStation),e.workStationCargados=!0}))}},{key:"programarVisita",value:function(){var e,o=this,i=_createForOfIteratorHelper(this.serviciosElegidos);try{for(i.s();!(e=i.n()).done;){var n,r=e.value,t=_createForOfIteratorHelper(r.equipos);try{for(t.s();!(n=t.n()).done;){var c=n.value;this.serviciosParaEnviar.push({id_servicio:r.id_servicio,id_tecnico:c.tecnico,id_equipo:c.id_equipo})}}catch(u){t.e(u)}finally{t.f()}}}catch(u){i.e(u)}finally{i.f()}var s,a=[],l=_createForOfIteratorHelper(this.grupoWorkStationElegidos);try{for(l.s();!(s=l.n()).done;)s.value.tecnico.forEach((function(e){console.log(1);for(var i=0;i<e.equipos.length;i++){var n=e.equipos[i];if(console.warn(n),console.log(2),(null==n?void 0:n.length)>=1)for(var r=function(i){console.log(i,"/",n.length);var r=n[i];(null==r?void 0:r.selected)&&(a.find((function(e){return e.id_servicio==r.id_servicio&&e.id_equipo==r.id_equipo}))||(console.log("SI IF"),console.warn(r),a.push({id_servicio:r.id_servicio,id_tecnico:e.id_tecnico,id_equipo:r.id_equipo}),o.serviciosParaEnviar.push({id_servicio:r.id_servicio,id_tecnico:e.id_tecnico,id_equipo:r.id_equipo})))},t=0;t<n.length;t++)r(t)}}))}catch(u){l.e(u)}finally{l.f()}console.log(a),console.log(this.serviciosParaEnviar),this.api.crear_visita({id_cliente:this.id_cliente_elegido,id_sucursal:this.sucursal_elegida,servicios:this.serviciosParaEnviar,fecha_visita:this.fecha_elegida}).subscribe((function(e){console.log(e),location.reload()}))}},{key:"serviciosElegidosChange",value:function(){var e=this;this.serviciosElegidos=[];var o,i=_createForOfIteratorHelper(this.servicios_elegidosAux);try{for(i.s();!(o=i.n()).done;){var n,r=o.value,t=_createForOfIteratorHelper(this.listado_servicios);try{for(t.s();!(n=t.n()).done;){var c=n.value;c.id_servicio==r&&0==c.qr&&this.serviciosElegidos.push(c)}}catch(b){t.e(b)}finally{t.f()}}}catch(b){i.e(b)}finally{i.f()}var s=[{nombre_equipo_grupo:null,id_equipo_grupo:null,tecnico:null,equipos:[]}],a=0,l=!0;this.grupoWorkStation.forEach((function(o){o.equipos.forEach((function(i){var n=i.id_servicio.toString();e.servicios_elegidosAux.includes(n)&&(e.checkExist(s,o.nombre_equipo_grupo)||null==s[0].nombre_equipo_grupo?l?(l=!1,console.log("2"),s=[{nombre_equipo_grupo:o.nombre_equipo_grupo,id_equipo_grupo:o.id_equipo_grupo,tecnico:null,equipos:[i]}]):(console.log("1"),a+=1,l=!1,s.push({nombre_equipo_grupo:o.nombre_equipo_grupo,id_equipo_grupo:o.id_equipo_grupo,tecnico:null,equipos:[i]})):(console.log("3"),s[a].equipos.push(i)))}))}));for(var u=0;u<s.length;u++){var d=s[u];console.log(d.equipos),d.equipos.sort(this.ordenarEquipos)}this.grupoWorkStationElegidos=s,this.show=!0,null==this.grupoWorkStationElegidos[0].nombre_equipo_grupo&&(this.show=!1),console.log("Servicio elegidos: ",s)}},{key:"checkExist",value:function(e,o){return null==e.find((function(e){return e.nombre_equipo_grupo==o}))}},{key:"ordenarClientes",value:function(e,o){return e.razon_social_cliente.toLowerCase()>o.razon_social_cliente.toLowerCase()?1:e.razon_social_cliente.toLowerCase()<o.razon_social_cliente.toLowerCase()?-1:0}},{key:"ordenarSucursales",value:function(e,o){return e.razon_social_sucursal.toLowerCase()>o.razon_social_sucursal.toLowerCase()?1:e.razon_social_sucursal.toLowerCase()<o.razon_social_sucursal.toLowerCase()?-1:0}},{key:"ordenarEquipos",value:function(e,o){return e.nombre_equipo.toLowerCase()>o.nombre_equipo.toLowerCase()?1:e.nombre_equipo.toLowerCase()<o.nombre_equipo.toLowerCase()?-1:0}},{key:"ordenarTecnicos",value:function(e,o){return e.nombre_tecnico.toLowerCase()>o.nombre_tecnico.toLowerCase()?1:e.nombre_tecnico.toLowerCase()<o.nombre_tecnico.toLowerCase()?-1:0}},{key:"presentAlertCheckbox",value:function(e,o,i){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,t,c,s,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i||(i=[]),r=[],t=_createForOfIteratorHelper(this.listado_tecnicos);try{for(t.s();!(c=t.n()).done;)s=c.value,console.log(s),i.includes(s)?r.push({name:s.nombre_tecnico,type:"checkbox",label:s.nombre_tecnico,value:s,checked:!0}):r.push({name:s.nombre_tecnico,type:"checkbox",label:s.nombre_tecnico,value:s})}catch(l){t.e(l)}finally{t.f()}return n.next=6,this.alertController.create({cssClass:"my-custom-class",header:"Checkbox",inputs:r,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(i){console.error(i),e.tecnico=i,e.tecnico.forEach((function(i){i.equipos||(i.equipos=[]),i.equipos[o]=[];for(var n=0;n<e.equipos.length;n++){var r=e.equipos[n];r.selected=1==e.tecnico.length,i.equipos[o].push(JSON.parse(JSON.stringify(r)))}console.log(i)})),console.log(i,"data"),console.log(e)}}]});case 6:return a=n.sent,n.next=9,a.present();case 9:case"end":return n.stop()}}),n,this)})))}},{key:"prueba",value:function(e,o,i,n){for(var r=0;r<e.tecnico.length;r++){var t=e.tecnico[r];o!=r&&t.equipos[i][n].selected&&(t.equipos[i][n].selected=!1)}}}]),e}(),k.\u0275fac=function(e){return new(e||k)(l.Jb(u.a),l.Jb(d.a),l.Jb(t.a))},k.\u0275cmp=l.Db({type:k,selectors:[["app-programar-visita"]],decls:27,vars:19,consts:[[2,"margin-top","15px"],["fixed","",2,"text-align","center"],[3,"interfaceOptions","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"interfaceOptions","disabled","ngModel","ionChange","ngModelChange"],["multiple","true",3,"interfaceOptions","disabled","ngModel","ngModelChange","ionChange"],["style","text-align: center;",4,"ngFor","ngForOf"],[4,"ngIf"],["displayFormat","DDDD D MMMM YYYY HH:mm","max","2022",3,"ngModel","doneText","cancelText","monthNames","dayNames","min","value","ngModelChange"],[2,"width","100%","text-align","center"],[3,"click"],[2,"margin-top","25px"],["src","../../../assets/LogoCPA-01.png",1,"imagen_empresa"],[3,"value"],[2,"text-align","center"],[4,"ngFor","ngForOf"],["fixed","",2,"text-align","center","color","var(--ion-color-secondary)","font-weight","bold"],[2,"margin-top","10px"],[3,"interfaceOptions","ngModel","ngModelChange"],[2,"margin-top","10px",3,"click"],["offset","3","size","3",2,"text-align","start"],[2,"font-weight","bold"],[3,"size",4,"ngFor","ngForOf"],["style","min-width:50%;",4,"ngFor","ngForOf"],[3,"size"],[2,"min-width","50%"],["offset","3","size","3",2,"text-align","start","border-bottom","1px solid black"],[2,"color","var(--ion-color-secondary)","font-weight","bold"],["style","border-bottom: 1px solid;",3,"size",4,"ngFor","ngForOf"],[2,"border-bottom","1px solid",3,"size"],[3,"ngModel","checked","click","ngModelChange"]],template:function(e,o){1&e&&(l.Ob(0,"ion-content"),l.Ob(1,"ion-item",0),l.Ob(2,"ion-label",1),l.kc(3,"Seleccionar un cliente"),l.Nb(),l.Ob(4,"ion-select",2),l.Wb("ionChange",(function(e){return o.sucursalesCliente(e.target.value)})),l.jc(5,b,2,2,"ion-select-option",3),l.Nb(),l.Nb(),l.Ob(6,"ion-item"),l.Ob(7,"ion-label",1),l.kc(8,"Seleccionar una sucursal"),l.Nb(),l.Ob(9,"ion-select",4),l.Wb("ionChange",(function(){return o.selectSucursal()}))("ngModelChange",(function(e){return o.sucursal_elegida=e})),l.jc(10,p,2,2,"ion-select-option",3),l.Nb(),l.Nb(),l.Ob(11,"ion-item"),l.Ob(12,"ion-label",1),l.kc(13,"Seleccionar servicios a ofrecer"),l.Nb(),l.Ob(14,"ion-select",5),l.Wb("ngModelChange",(function(e){return o.servicios_elegidosAux=e}))("ionChange",(function(){return o.serviciosElegidosChange()})),l.jc(15,_,2,2,"ion-select-option",3),l.Nb(),l.Nb(),l.jc(16,v,4,2,"div",6),l.jc(17,C,2,1,"div",7),l.Ob(18,"ion-item"),l.Ob(19,"ion-label",1),l.kc(20,"Elegir una fecha"),l.Nb(),l.Ob(21,"ion-datetime",8),l.Wb("ngModelChange",(function(e){return o.fecha_elegida=e})),l.Nb(),l.Nb(),l.Ob(22,"div",9),l.Ob(23,"ion-button",10),l.Wb("click",(function(){return o.programarVisita()})),l.kc(24,"Agendar"),l.Nb(),l.Nb(),l.Ob(25,"div",11),l.Kb(26,"img",12),l.Nb(),l.Nb()),2&e&&(l.zb(4),l.dc("interfaceOptions",o.custom),l.zb(1),l.dc("ngForOf",o.listado_clientes),l.zb(4),l.dc("interfaceOptions",o.custom)("disabled",null==o.id_cliente_elegido)("ngModel",o.sucursal_elegida),l.zb(1),l.dc("ngForOf",o.listado_sucursales_cliente),l.zb(4),l.dc("interfaceOptions",o.custom)("disabled",null==o.sucursal_elegida&&!o.equiposCargados&&!o.workStationCargados)("ngModel",o.servicios_elegidosAux),l.zb(1),l.dc("ngForOf",o.listado_servicios),l.zb(1),l.dc("ngForOf",o.serviciosElegidos),l.zb(1),l.dc("ngIf",o.show),l.zb(4),l.ec("min",o.fecha_actual),l.ec("value",o.fecha_actual),l.dc("ngModel",o.fecha_elegida)("doneText","Listo")("cancelText","Cancelar")("monthNames",o.monthNames)("dayNames",o.dayNames))},directives:[t.i,t.r,t.s,t.w,t.M,n.i,r.d,r.e,n.j,t.j,t.d,t.x,t.u,t.h,t.g,t.b],styles:["ion-item[_ngcontent-%COMP%]{margin-bottom:10px}.imagen_empresa[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]{width:50%;margin-left:25%}h2[_ngcontent-%COMP%]{color:var(--ion-color-primary)}"]}),k)}],z=((N=function e(){_classCallCheck(this,e)}).\u0275mod=l.Hb({type:N}),N.\u0275inj=l.Gb({factory:function(e){return new(e||N)},imports:[[c.h.forChild(x)],c.h]}),N),S=((w=function e(){_classCallCheck(this,e)}).\u0275mod=l.Hb({type:w}),w.\u0275inj=l.Gb({factory:function(e){return new(e||w)},imports:[[n.b,r.a,t.E,z]]}),w)}}]);