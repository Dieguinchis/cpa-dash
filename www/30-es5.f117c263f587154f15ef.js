function _createForOfIteratorHelper(i,e){var o;if("undefined"==typeof Symbol||null==i[Symbol.iterator]){if(Array.isArray(i)||(o=_unsupportedIterableToArray(i))||e&&i&&"number"==typeof i.length){o&&(i=o);var n=0,r=function(){};return{s:r,n:function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}},e:function(i){throw i},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,c=!0,s=!1;return{s:function(){o=i[Symbol.iterator]()},n:function(){var i=o.next();return c=i.done,i},e:function(i){s=!0,t=i},f:function(){try{c||null==o.return||o.return()}finally{if(s)throw t}}}}function _unsupportedIterableToArray(i,e){if(i){if("string"==typeof i)return _arrayLikeToArray(i,e);var o=Object.prototype.toString.call(i).slice(8,-1);return"Object"===o&&i.constructor&&(o=i.constructor.name),"Map"===o||"Set"===o?Array.from(i):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(i,e):void 0}}function _arrayLikeToArray(i,e){(null==e||e>i.length)&&(e=i.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=i[o];return n}function _classCallCheck(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function _createClass(i,e,o){return e&&_defineProperties(i.prototype,e),o&&_defineProperties(i,o),i}(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"2HF3":function(i,e,o){"use strict";o.r(e),o.d(e,"ProgramarVisitaPageModule",(function(){return k}));var n=o("ofXK"),r=o("3Pt+"),t=o("TEn/"),c=o("tyNb"),s=o("wd/R"),a=o("fXoL"),l=o("89nv"),u=o("u//c");function b(i,e){if(1&i&&(a.Mb(0,"ion-select-option",13),a.ic(1),a.Lb()),2&i){var o=e.$implicit;a.cc("value",o.id_cliente),a.zb(1),a.jc(o.razon_social_cliente)}}function d(i,e){if(1&i&&(a.Mb(0,"ion-select-option",13),a.ic(1),a.Lb()),2&i){var o=e.$implicit;a.cc("value",o.id_sucursal),a.zb(1),a.jc(o.razon_social_sucursal)}}function _(i,e){if(1&i&&(a.Mb(0,"ion-select-option",13),a.ic(1),a.Lb()),2&i){var o=e.$implicit;a.cc("value",o.id_servicio),a.zb(1),a.jc(o.nombre_servicio)}}function p(i,e){if(1&i&&(a.Mb(0,"ion-select-option",13),a.ic(1),a.Lb()),2&i){var o=e.$implicit;a.cc("value",o.id_tecnico),a.zb(1),a.lc("",o.nombre_tecnico," ",o.apellido_tecnico,"")}}function g(i,e){if(1&i){var o=a.Nb();a.Mb(0,"div"),a.Mb(1,"ion-label",16),a.ic(2),a.Lb(),a.Mb(3,"ion-item",17),a.Mb(4,"ion-label",1),a.ic(5,"Seleccionar t\xe9cnico a cargo"),a.Lb(),a.Mb(6,"ion-select",18),a.Ub("ngModelChange",(function(i){return a.ec(o),e.$implicit.tecnico=i})),a.hc(7,p,2,3,"ion-select-option",3),a.Lb(),a.Lb(),a.Lb()}if(2&i){var n=e.$implicit,r=a.Wb(2);a.zb(2),a.jc(n.nombre_equipo),a.zb(4),a.bc("ngModel",n.tecnico),a.zb(1),a.bc("ngForOf",r.listado_tecnicos)}}function f(i,e){if(1&i&&(a.Mb(0,"div",14),a.Mb(1,"h2",14),a.ic(2),a.Lb(),a.hc(3,g,8,3,"div",15),a.Lb()),2&i){var o=e.$implicit;a.zb(2),a.jc(o.nombre_servicio),a.zb(1),a.bc("ngForOf",o.equipos)}}function v(i,e){if(1&i&&(a.Mb(0,"div"),a.Mb(1,"ion-label",16),a.ic(2),a.Lb(),a.Lb()),2&i){var o=e.$implicit;a.zb(2),a.lc("",o.nombre_equipo,": ",o.nombre_servicio,"")}}function h(i,e){if(1&i&&(a.Mb(0,"ion-select-option",13),a.ic(1),a.Lb()),2&i){var o=e.$implicit;a.cc("value",o.id_tecnico),a.zb(1),a.lc("",o.nombre_tecnico," ",o.apellido_tecnico,"")}}function m(i,e){if(1&i){var o=a.Nb();a.Mb(0,"div",14),a.Mb(1,"h2",14),a.ic(2),a.Lb(),a.hc(3,v,3,2,"div",15),a.Mb(4,"ion-item",17),a.Mb(5,"ion-label",1),a.ic(6,"Seleccionar t\xe9cnico a cargo"),a.Lb(),a.Mb(7,"ion-select",18),a.Ub("ngModelChange",(function(i){return a.ec(o),e.$implicit.tecnico=i})),a.hc(8,h,2,3,"ion-select-option",3),a.Lb(),a.Lb(),a.Lb()}if(2&i){var n=e.$implicit,r=a.Wb(2);a.zb(2),a.jc(n.nombre_equipo_grupo),a.zb(1),a.bc("ngForOf",n.equipos),a.zb(4),a.bc("ngModel",n.tecnico),a.zb(1),a.bc("ngForOf",r.listado_tecnicos)}}function q(i,e){if(1&i&&(a.Mb(0,"div"),a.hc(1,m,9,4,"div",6),a.Lb()),2&i){var o=a.Wb();a.zb(1),a.bc("ngForOf",o.grupoWorkStationElegidos)}}var y,M,L,C=[{path:"",component:(y=function(){function i(e,o){_classCallCheck(this,i),this.api=e,this.api_tecnicos=o,this.serviciosConEquipos=[],this.serviciosElegidos=[],this.serviciosParaEnviar=[],this.grupoWorkStation=[],this.grupoWorkStationElegidos=[],this.show=!1,this.servicios_elegidosAux=[],this.id_cliente_elegido=null,this.sucursal_elegida=null,this.dayNames=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],this.monthNames=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.api.mostrar_servicios().subscribe((function(e){i.listado_servicios=e,i.listado_servicios=i.listado_servicios.result,console.log(i.listado_servicios,"servicios"),i.api.listado_equipos().subscribe((function(e){i.equipos=e.result,console.log(i.equipos,"equipos");var o,n=_createForOfIteratorHelper(i.listado_servicios);try{for(n.s();!(o=n.n()).done;){var r=o.value;r.equipos=[];var t,c=_createForOfIteratorHelper(i.equipos);try{for(c.s();!(t=c.n()).done;){var s=t.value;s.id_servicio==r.id_servicio&&r.equipos.push(s)}}catch(a){c.e(a)}finally{c.f()}r.equipos.length<1&&r.equipos.push({id_equipo:0,id_servicio:r.id_servicio,nombre_equipo:"Servicio principal"})}}catch(a){n.e(a)}finally{n.f()}console.log(i.listado_servicios,"servicios completos")}))})),this.api.listado_clientes().subscribe((function(e){i.listado_clientes=e,i.listado_clientes=i.listado_clientes.result,console.log(i.listado_clientes)})),this.api_tecnicos.listado_tecnicos().subscribe((function(e){i.listado_tecnicos=e,i.listado_tecnicos=i.listado_tecnicos.result,console.log(i.listado_tecnicos)}),(function(i){console.log(i)})),this.fecha_actual=s().format()}},{key:"sucursalesCliente",value:function(i){var e=this;this.api.informacion_cliente(i).subscribe((function(o){e.listado_sucursales_cliente=o,console.log(o),e.listado_sucursales_cliente=e.listado_sucursales_cliente.result.sucursales.datosSucursal,e.sucursal_elegida=null,e.id_cliente_elegido=i,console.log(e.listado_sucursales_cliente)}))}},{key:"selectSucursal",value:function(){var i=this;this.api.listado_grupoWorkstations(this.sucursal_elegida).subscribe((function(e){var o=0,n=[],r=0,t=!0;"error"==e.status?alert("Ocurrio un error: "+e.message):(e.result.forEach((function(i){i.id_equipo_grupo==o?n[r].equipos.push({id_equipo:i.id_equipo,id_servicio:i.id_servicio,id_sucursal:i.id_sucursal,nombre_equipo:i.nombre_equipo,codigo_qr_equipo:i.codigo_qr_equipo,estado_servicio:i.estado_servicio,nombre_servicio:i.nombre_servicio,qr:i.qr}):(t||r++,o=i.id_equipo_grupo,n.push({nombre_equipo_grupo:i.nombre_equipo_grupo,id_equipo_grupo:i.id_equipo_grupo,equipos:[]}),n[r].equipos.push({id_equipo:i.id_equipo,id_servicio:i.id_servicio,id_sucursal:i.id_sucursal,nombre_equipo:i.nombre_equipo,codigo_qr_equipo:i.codigo_qr_equipo,estado_servicio:i.estado_servicio,nombre_servicio:i.nombre_servicio,qr:i.qr}),t=!1)})),i.grupoWorkStation=n)}))}},{key:"programarVisita",value:function(){var i,e=_createForOfIteratorHelper(this.serviciosElegidos);try{for(e.s();!(i=e.n()).done;){var o,n=i.value,r=_createForOfIteratorHelper(n.equipos);try{for(r.s();!(o=r.n()).done;){var t=o.value;this.serviciosParaEnviar.push({id_servicio:n.id_servicio,id_tecnico:t.tecnico,id_equipo:t.id_equipo})}}catch(d){r.e(d)}finally{r.f()}}}catch(d){e.e(d)}finally{e.f()}var c,s=_createForOfIteratorHelper(this.grupoWorkStationElegidos);try{for(s.s();!(c=s.n()).done;){var a,l=c.value,u=_createForOfIteratorHelper(l.equipos);try{for(u.s();!(a=u.n()).done;){var b=a.value;this.serviciosParaEnviar.push({id_servicio:b.id_servicio,id_tecnico:l.tecnico,id_equipo:b.id_equipo})}}catch(d){u.e(d)}finally{u.f()}}}catch(d){s.e(d)}finally{s.f()}console.log(this.serviciosParaEnviar),this.api.crear_visita({id_cliente:this.id_cliente_elegido,id_sucursal:this.sucursal_elegida,servicios:this.serviciosParaEnviar,fecha_visita:this.fecha_elegida}).subscribe((function(i){console.log(i),location.reload()}))}},{key:"serviciosElegidosChange",value:function(){var i=this;this.serviciosElegidos=[];var e,o=_createForOfIteratorHelper(this.servicios_elegidosAux);try{for(o.s();!(e=o.n()).done;){var n,r=e.value,t=_createForOfIteratorHelper(this.listado_servicios);try{for(t.s();!(n=t.n()).done;){var c=n.value;c.id_servicio==r&&0==c.qr&&this.serviciosElegidos.push(c)}}catch(u){t.e(u)}finally{t.f()}}}catch(u){o.e(u)}finally{o.f()}var s=[{nombre_equipo_grupo:null,id_equipo_grupo:null,tecnico:null,equipos:[]}],a=0,l=!0;this.grupoWorkStation.forEach((function(e){e.equipos.forEach((function(o){var n=o.id_servicio.toString();i.servicios_elegidosAux.includes(n)&&(i.checkExist(s,e.nombre_equipo_grupo)||null==s[0].nombre_equipo_grupo?l?(l=!1,console.log("2"),s=[{nombre_equipo_grupo:e.nombre_equipo_grupo,id_equipo_grupo:e.id_equipo_grupo,tecnico:null,equipos:[o]}]):(console.log("1"),a+=1,l=!1,s.push({nombre_equipo_grupo:e.nombre_equipo_grupo,id_equipo_grupo:e.id_equipo_grupo,tecnico:null,equipos:[o]})):(console.log("3"),s[a].equipos.push(o)))}))})),this.grupoWorkStationElegidos=s,this.show=!0,null==this.grupoWorkStationElegidos[0].nombre_equipo_grupo&&(this.show=!1),console.log("Servicio elegidos: ",s)}},{key:"checkExist",value:function(i,e){return null==i.find((function(i){return i.nombre_equipo_grupo==e}))}}]),i}(),y.\u0275fac=function(i){return new(i||y)(a.Jb(l.a),a.Jb(u.a))},y.\u0275cmp=a.Db({type:y,selectors:[["app-programar-visita"]],decls:27,vars:16,consts:[[2,"margin-top","15px"],["fixed","",2,"text-align","center"],[3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled","ngModel","ionChange","ngModelChange"],["multiple","true",3,"disabled","ngModel","ngModelChange","ionChange"],["style","text-align: center;",4,"ngFor","ngForOf"],[4,"ngIf"],["displayFormat","DDDD D MMMM YYYY HH:mm","max","2022",3,"ngModel","doneText","cancelText","monthNames","dayNames","min","value","ngModelChange"],[2,"width","100%","text-align","center"],[3,"click"],[2,"margin-top","25px"],["src","../../../assets/LogoCPA-01.png",1,"imagen_empresa"],[3,"value"],[2,"text-align","center"],[4,"ngFor","ngForOf"],["fixed","",2,"text-align","center","color","var(--ion-color-secondary)","font-weight","bold"],[2,"margin-top","10px"],[3,"ngModel","ngModelChange"]],template:function(i,e){1&i&&(a.Mb(0,"ion-content"),a.Mb(1,"ion-item",0),a.Mb(2,"ion-label",1),a.ic(3,"Seleccionar un cliente"),a.Lb(),a.Mb(4,"ion-select",2),a.Ub("ionChange",(function(i){return e.sucursalesCliente(i.target.value)})),a.hc(5,b,2,2,"ion-select-option",3),a.Lb(),a.Lb(),a.Mb(6,"ion-item"),a.Mb(7,"ion-label",1),a.ic(8,"Seleccionar una sucursal"),a.Lb(),a.Mb(9,"ion-select",4),a.Ub("ionChange",(function(){return e.selectSucursal()}))("ngModelChange",(function(i){return e.sucursal_elegida=i})),a.hc(10,d,2,2,"ion-select-option",3),a.Lb(),a.Lb(),a.Mb(11,"ion-item"),a.Mb(12,"ion-label",1),a.ic(13,"Seleccionar servicios a ofrecer"),a.Lb(),a.Mb(14,"ion-select",5),a.Ub("ngModelChange",(function(i){return e.servicios_elegidosAux=i}))("ionChange",(function(){return e.serviciosElegidosChange()})),a.hc(15,_,2,2,"ion-select-option",3),a.Lb(),a.Lb(),a.hc(16,f,4,2,"div",6),a.hc(17,q,2,1,"div",7),a.Mb(18,"ion-item"),a.Mb(19,"ion-label",1),a.ic(20,"Elegir una fecha"),a.Lb(),a.Mb(21,"ion-datetime",8),a.Ub("ngModelChange",(function(i){return e.fecha_elegida=i})),a.Lb(),a.Lb(),a.Mb(22,"div",9),a.Mb(23,"ion-button",10),a.Ub("click",(function(){return e.programarVisita()})),a.ic(24,"Agendar"),a.Lb(),a.Lb(),a.Mb(25,"div",11),a.Kb(26,"img",12),a.Lb(),a.Lb()),2&i&&(a.zb(5),a.bc("ngForOf",e.listado_clientes),a.zb(4),a.bc("disabled",null==e.id_cliente_elegido)("ngModel",e.sucursal_elegida),a.zb(1),a.bc("ngForOf",e.listado_sucursales_cliente),a.zb(4),a.bc("disabled",null==e.sucursal_elegida)("ngModel",e.servicios_elegidosAux),a.zb(1),a.bc("ngForOf",e.listado_servicios),a.zb(1),a.bc("ngForOf",e.serviciosElegidos),a.zb(1),a.bc("ngIf",e.show),a.zb(4),a.cc("min",e.fecha_actual),a.cc("value",e.fecha_actual),a.bc("ngModel",e.fecha_elegida)("doneText","Listo")("cancelText","Cancelar")("monthNames",e.monthNames)("dayNames",e.dayNames))},directives:[t.g,t.m,t.n,t.q,t.G,n.i,r.d,r.e,n.j,t.h,t.c,t.r],styles:["ion-item[_ngcontent-%COMP%]{margin-bottom:10px}.imagen_empresa[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]{width:50%;margin-left:25%}h2[_ngcontent-%COMP%]{color:var(--ion-color-primary)}"]}),y)}],O=((L=function i(){_classCallCheck(this,i)}).\u0275mod=a.Hb({type:L}),L.\u0275inj=a.Gb({factory:function(i){return new(i||L)},imports:[[c.h.forChild(C)],c.h]}),L),k=((M=function i(){_classCallCheck(this,i)}).\u0275mod=a.Hb({type:M}),M.\u0275inj=a.Gb({factory:function(i){return new(i||M)},imports:[[n.b,r.a,t.y,O]]}),M)}}]);