(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{"2HF3":function(i,o,e){"use strict";e.r(o),e.d(o,"ProgramarVisitaPageModule",(function(){return E}));var c=e("ofXK"),n=e("3Pt+"),s=e("TEn/"),t=e("tyNb"),r=e("mrSG"),l=e("wd/R"),a=e("fXoL"),u=e("89nv"),d=e("u//c");function b(i,o){if(1&i&&(a.Ob(0,"ion-select-option",13),a.kc(1),a.Nb()),2&i){const i=o.$implicit;a.ec("value",i.id_cliente),a.zb(1),a.lc(i.razon_social_cliente)}}function p(i,o){if(1&i&&(a.Ob(0,"ion-select-option",13),a.kc(1),a.Nb()),2&i){const i=o.$implicit;a.ec("value",i.id_sucursal),a.zb(1),a.lc(i.razon_social_sucursal)}}function g(i,o){if(1&i&&(a.Ob(0,"ion-select-option",13),a.kc(1),a.Nb()),2&i){const i=o.$implicit;a.ec("value",i.id_servicio),a.zb(1),a.lc(i.nombre_servicio)}}function _(i,o){if(1&i&&(a.Ob(0,"ion-select-option",13),a.kc(1),a.Nb()),2&i){const i=o.$implicit;a.dc("value",i),a.zb(1),a.nc("",i.nombre_tecnico," ",i.apellido_tecnico,"")}}function h(i,o){if(1&i){const i=a.Pb();a.Ob(0,"div"),a.Ob(1,"h2",14),a.kc(2,"Tecnico principal"),a.Nb(),a.Ob(3,"div"),a.Ob(4,"ion-item",15),a.Ob(5,"ion-label",1),a.kc(6,"Tecnico principal"),a.Nb(),a.Ob(7,"ion-select",16),a.Wb("ionChange",(function(){return a.gc(i),a.Yb().selectTecnicoPrincipal()}))("ngModelChange",(function(o){return a.gc(i),a.Yb().tecnicoPrincipal=o})),a.jc(8,_,2,3,"ion-select-option",3),a.Nb(),a.Nb(),a.Nb(),a.Nb()}if(2&i){const i=a.Yb();a.zb(7),a.dc("interfaceOptions",i.custom)("ngModel",i.tecnicoPrincipal),a.zb(1),a.dc("ngForOf",i.listado_tecnicos)}}function f(i,o){if(1&i&&(a.Ob(0,"ion-select-option",13),a.kc(1),a.Nb()),2&i){const i=o.$implicit;a.ec("value",i.id_tecnico),a.zb(1),a.nc("",i.nombre_tecnico," ",i.apellido_tecnico,"")}}function m(i,o){if(1&i){const i=a.Pb();a.Ob(0,"div"),a.Ob(1,"ion-label",18),a.kc(2),a.Nb(),a.Ob(3,"ion-item",15),a.Ob(4,"ion-label",1),a.kc(5,"Seleccionar t\xe9cnico a cargo"),a.Nb(),a.Ob(6,"ion-select",19),a.Wb("ngModelChange",(function(e){return a.gc(i),o.$implicit.tecnico=e})),a.jc(7,f,2,3,"ion-select-option",3),a.Nb(),a.Nb(),a.Nb()}if(2&i){const i=o.$implicit,e=a.Yb(2);a.zb(2),a.lc(i.nombre_equipo),a.zb(4),a.dc("interfaceOptions",e.custom)("ngModel",i.tecnico),a.zb(1),a.dc("ngForOf",e.listado_tecnicos)}}function v(i,o){if(1&i&&(a.Ob(0,"div",14),a.Ob(1,"h2",14),a.kc(2),a.Nb(),a.jc(3,m,8,4,"div",17),a.Nb()),2&i){const i=o.$implicit;a.zb(2),a.lc(i.nombre_servicio),a.zb(1),a.dc("ngForOf",i.equipos)}}function q(i,o){if(1&i&&(a.Ob(0,"p"),a.kc(1),a.Nb()),2&i){const i=o.$implicit;a.zb(1),a.mc("",i.nombre_tecnico,", ")}}function O(i,o){if(1&i&&(a.Ob(0,"ion-col",25),a.kc(1),a.Nb()),2&i){const i=o.$implicit,e=a.Yb().$implicit;a.dc("size",3/e.tecnico.length),a.zb(1),a.mc(" ",i.nombre_tecnico," ")}}function C(i,o){if(1&i){const i=a.Pb();a.Ob(0,"ion-col",30),a.Ob(1,"ion-checkbox",31),a.Wb("click",(function(){a.gc(i);const e=o.index,c=a.Yb().index,n=a.Yb(),s=n.$implicit,t=n.index;return a.Yb(2).prueba(s,e,t,c)}))("ngModelChange",(function(e){a.gc(i);const c=o.$implicit,n=a.Yb().index,s=a.Yb().index;return c.equipos[s][n].selected=e})),a.Nb(),a.Nb()}if(2&i){const i=o.$implicit,e=a.Yb().index,c=a.Yb(),n=c.$implicit,s=c.index;a.dc("size",3/n.tecnico.length),a.zb(1),a.dc("ngModel",i.equipos[s][e].selected)("checked",1==n.tecnico.length)}}function N(i,o){if(1&i&&(a.Ob(0,"div",26),a.Ob(1,"ion-row"),a.Ob(2,"ion-col",27),a.Ob(3,"ion-label",28),a.kc(4),a.Nb(),a.Nb(),a.jc(5,C,2,3,"ion-col",29),a.Nb(),a.Nb()),2&i){const i=o.$implicit,e=a.Yb().$implicit;a.zb(4),a.nc("",i.nombre_equipo+" - "+i.zona+" - "+i.nro_equipo,": ",i.nombre_servicio,""),a.zb(1),a.dc("ngForOf",e.tecnico)}}function k(i,o){if(1&i){const i=a.Pb();a.Ob(0,"div",14),a.Ob(1,"h2",14),a.kc(2),a.Nb(),a.Ob(3,"ion-item",20),a.Wb("click",(function(){a.gc(i);const e=o.$implicit,c=o.index;return a.Yb(2).presentAlertCheckbox(e,c,e.tecnico)})),a.Ob(4,"ion-label",1),a.kc(5,"Seleccionar t\xe9cnicos a cargo"),a.Nb(),a.jc(6,q,2,1,"p",17),a.Nb(),a.Ob(7,"div"),a.Ob(8,"ion-row"),a.Ob(9,"ion-col",21),a.Ob(10,"ion-label",22),a.kc(11,"Equipo"),a.Nb(),a.Nb(),a.jc(12,O,2,2,"ion-col",23),a.Nb(),a.Nb(),a.jc(13,N,6,3,"div",24),a.Nb()}if(2&i){const i=o.$implicit;a.zb(2),a.lc(i.nombre_equipo_grupo),a.zb(4),a.dc("ngForOf",i.tecnico),a.zb(6),a.dc("ngForOf",i.tecnico),a.zb(1),a.dc("ngForOf",i.equipos)}}function z(i,o){if(1&i&&(a.Ob(0,"div"),a.jc(1,k,14,4,"div",7),a.Nb()),2&i){const i=a.Yb();a.zb(1),a.dc("ngForOf",i.grupoWorkStationElegidos)}}const w=[{path:"",component:(()=>{class i{constructor(i,o,e){this.api=i,this.api_tecnicos=o,this.alertController=e,this.serviciosConEquipos=[],this.serviciosElegidos=[],this.serviciosParaEnviar=[],this.grupoWorkStation=[],this.grupoWorkStationElegidos=[],this.show=!1,this.servicios_elegidosAux=[],this.id_cliente_elegido=null,this.sucursal_elegida=null,this.equiposCargados=!1,this.workStationCargados=!1,this.dayNames=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],this.monthNames=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],this.custom={cssClass:"alertSize"}}ngOnInit(){console.warn(1),this.api.mostrar_servicios().subscribe(i=>{console.warn(2),this.listado_servicios=i,this.listado_servicios=this.listado_servicios.result,console.log(this.listado_servicios,"servicios")}),this.api.listado_clientes().subscribe(i=>{this.listado_clientes=i,this.listado_clientes=this.listado_clientes.result,this.listado_clientes.sort(this.ordenarClientes),console.log(this.listado_clientes)}),this.api_tecnicos.listado_tecnicos().subscribe(i=>{this.listado_tecnicos=i,this.listado_tecnicos=this.listado_tecnicos.result,this.listado_tecnicos.sort(this.ordenarTecnicos),console.log(this.listado_tecnicos)},i=>{console.log(i)}),this.fecha_actual=l().format()}sucursalesCliente(i){this.api.informacion_cliente(i).subscribe(o=>{this.listado_sucursales_cliente=o,console.log(o),this.listado_sucursales_cliente=this.listado_sucursales_cliente.result.sucursales.datosSucursal,this.sucursal_elegida=null,this.id_cliente_elegido=i,this.listado_sucursales_cliente.sort(this.ordenarSucursales),console.log(this.listado_sucursales_cliente)})}selectSucursal(){null!=this.sucursal_elegida&&this.api.listado_equipos_id(this.sucursal_elegida).subscribe(i=>{this.equipos=i.result,console.log(this.equipos,"equipos");for(let o of this.listado_servicios){o.equipos=[];for(let i of this.equipos)i.id_servicio==o.id_servicio&&o.equipos.push(i);o.equipos.length<1&&o.equipos.push({id_equipo:0,id_servicio:o.id_servicio,nombre_equipo:"Servicio principal"})}console.log(this.listado_servicios,"servicios completos"),this.equiposCargados=!0}),this.api.listado_grupoWorkstations(this.sucursal_elegida).subscribe(i=>{var o=0,e=[],c=0,n=!0;"error"==i.status?alert("Ocurrio un error: "+i.message):(i.result.forEach(i=>{i.id_equipo_grupo==o?e[c].equipos.push({id_equipo:i.id_equipo,id_servicio:i.id_servicio,id_sucursal:i.id_sucursal,nombre_equipo:i.nombre_equipo,codigo_qr_equipo:i.codigo_qr_equipo,estado_servicio:i.estado_servicio,nombre_servicio:i.nombre_servicio,qr:i.qr,nro_equipo:i.nro_equipo,zona:i.zona}):(n||c++,o=i.id_equipo_grupo,e.push({nombre_equipo_grupo:i.nombre_equipo_grupo,id_equipo_grupo:i.id_equipo_grupo,equipos:[]}),e[c].equipos.push({id_equipo:i.id_equipo,id_servicio:i.id_servicio,id_sucursal:i.id_sucursal,nombre_equipo:i.nombre_equipo,codigo_qr_equipo:i.codigo_qr_equipo,estado_servicio:i.estado_servicio,nombre_servicio:i.nombre_servicio,qr:i.qr,nro_equipo:i.nro_equipo,zona:i.zona}),n=!1)}),this.grupoWorkStation=e),console.log("grupo2: ",this.grupoWorkStation),this.workStationCargados=!0})}programarVisita(){var i;for(let e of this.serviciosElegidos)for(let i of e.equipos)this.serviciosParaEnviar.push({id_servicio:e.id_servicio,id_tecnico:i.tecnico,id_equipo:i.id_equipo});var o=[];for(let e of this.grupoWorkStationElegidos)null===(i=e.tecnico)||void 0===i||i.forEach(i=>{console.log(1);for(let e=0;e<i.equipos.length;e++){const c=i.equipos[e];if(console.warn(c),console.log(2),(null==c?void 0:c.length)>=1)for(let e=0;e<c.length;e++){console.log(e,"/",c.length);const n=c[e];(null==n?void 0:n.selected)&&(o.find(i=>i.id_servicio==n.id_servicio&&i.id_equipo==n.id_equipo)||(console.log("SI IF"),console.warn(n),o.push({id_servicio:n.id_servicio,id_tecnico:i.id_tecnico,id_equipo:n.id_equipo}),this.serviciosParaEnviar.push({id_servicio:n.id_servicio,id_tecnico:i.id_tecnico,id_equipo:n.id_equipo})))}}});console.log(o),console.log(this.serviciosParaEnviar),this.api.crear_visita({id_cliente:this.id_cliente_elegido,id_sucursal:this.sucursal_elegida,servicios:this.serviciosParaEnviar,fecha_visita:this.fecha_elegida}).subscribe(i=>{console.log(i),location.reload()})}serviciosElegidosChange(){this.serviciosElegidos=[];for(let c of this.servicios_elegidosAux)for(let i of this.listado_servicios)i.id_servicio==c&&0==i.qr&&this.serviciosElegidos.push(i);var i=[{nombre_equipo_grupo:null,id_equipo_grupo:null,tecnico:null,equipos:[]}],o=0,e=!0;this.grupoWorkStation.forEach(c=>{c.equipos.forEach(n=>{console.log(n);var s=n.id_servicio.toString();this.servicios_elegidosAux.includes(s)&&(this.checkExist(i,c.nombre_equipo_grupo)||null==i[0].nombre_equipo_grupo?e?(e=!1,console.log("2"),i=[{nombre_equipo_grupo:c.nombre_equipo_grupo,id_equipo_grupo:c.id_equipo_grupo,tecnico:null,equipos:[n]}]):(console.log("1"),o+=1,e=!1,i.push({nombre_equipo_grupo:c.nombre_equipo_grupo,id_equipo_grupo:c.id_equipo_grupo,tecnico:null,equipos:[n]})):(console.log("3"),i[o].equipos.push(n)))})});for(let c=0;c<i.length;c++){const o=i[c];console.log(o.equipos),o.equipos.sort(this.ordenarEquipos)}this.grupoWorkStationElegidos=i,this.show=!0,null==this.grupoWorkStationElegidos[0].nombre_equipo_grupo&&(this.show=!1),console.log("Servicio elegidos: ",i)}checkExist(i,o){return null==i.find(i=>i.nombre_equipo_grupo==o)}ordenarClientes(i,o){return i.razon_social_cliente.toLowerCase()>o.razon_social_cliente.toLowerCase()?1:i.razon_social_cliente.toLowerCase()<o.razon_social_cliente.toLowerCase()?-1:0}ordenarSucursales(i,o){return i.razon_social_sucursal.toLowerCase()>o.razon_social_sucursal.toLowerCase()?1:i.razon_social_sucursal.toLowerCase()<o.razon_social_sucursal.toLowerCase()?-1:0}ordenarEquipos(i,o){return i.nombre_equipo.toLowerCase()>o.nombre_equipo.toLowerCase()?1:i.nombre_equipo.toLowerCase()<o.nombre_equipo.toLowerCase()?-1:0}ordenarTecnicos(i,o){return i.nombre_tecnico.toLowerCase()>o.nombre_tecnico.toLowerCase()?1:i.nombre_tecnico.toLowerCase()<o.nombre_tecnico.toLowerCase()?-1:0}presentAlertCheckbox(i,o,e){return Object(r.a)(this,void 0,void 0,(function*(){e||(e=[]);var c=[];for(let i of this.listado_tecnicos)console.log(i),e.includes(i)?c.push({name:i.nombre_tecnico,type:"checkbox",label:i.nombre_tecnico,value:i,checked:!0}):c.push({name:i.nombre_tecnico,type:"checkbox",label:i.nombre_tecnico,value:i});const n=yield this.alertController.create({cssClass:"my-custom-class",header:"Checkbox",inputs:c,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:e=>{i.tecnico=e,i.tecnico.forEach(e=>{e.equipos||(e.equipos=[]),e.equipos[o]=[];for(let c=0;c<i.equipos.length;c++){const n=i.equipos[c];n.selected=1==i.tecnico.length,e.equipos[o].push(JSON.parse(JSON.stringify(n)))}console.log(e)}),this.tecnicoPrincipal&&(this.tecnicoPrincipal=this.listado_tecnicos.find(i=>i.id_tecnico==this.tecnicoPrincipal.id_tecnico),i.tecnico.find(i=>i.id_tecnico==this.tecnicoPrincipal.id_tecnico)||(this.tecnicoPrincipal.equipos[o]=[],this.listado_tecnicos[this.listado_tecnicos.findIndex(i=>i.id_tecnico==this.tecnicoPrincipal.id_tecnico)]=this.tecnicoPrincipal)),console.log(e,"data"),console.log(i),console.log(this.grupoWorkStationElegidos),console.log(this.listado_tecnicos,"TECNISO")}}]});yield n.present()}))}prueba(i,o,e,c){for(let n=0;n<i.tecnico.length;n++){const s=i.tecnico[n];o!=n&&s.equipos[e][c].selected&&(s.equipos[e][c].selected=!1)}}selectTecnicoPrincipal(){console.log(this.serviciosElegidos),console.log(this.tecnicoPrincipal);var i=[];for(let o of this.serviciosElegidos)for(let i of o.equipos)i.tecnico=this.tecnicoPrincipal.id_tecnico.toString();for(let o of this.grupoWorkStationElegidos)o.equipos.forEach(i=>{i.selected=!0}),i.push(o.equipos);for(let o of this.grupoWorkStationElegidos)o.tecnico=[],o.tecnico[0]=this.tecnicoPrincipal,o.tecnico[0].equipos=i;console.log(this.tecnicoPrincipal),console.log(this.grupoWorkStationElegidos)}}return i.\u0275fac=function(o){return new(o||i)(a.Jb(u.a),a.Jb(d.a),a.Jb(s.a))},i.\u0275cmp=a.Db({type:i,selectors:[["app-programar-visita"]],decls:28,vars:20,consts:[[2,"margin-top","15px"],["fixed","",2,"text-align","center"],[3,"interfaceOptions","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"interfaceOptions","disabled","ngModel","ionChange","ngModelChange"],["multiple","true",3,"interfaceOptions","disabled","ngModel","ngModelChange","ionChange"],[4,"ngIf"],["style","text-align: center;",4,"ngFor","ngForOf"],["displayFormat","DDDD D MMMM YYYY HH:mm","max","2022",3,"ngModel","doneText","cancelText","monthNames","dayNames","min","value","ngModelChange"],[2,"width","100%","text-align","center"],[3,"click"],[2,"margin-top","25px"],["src","../../../assets/LogoCPA-01.png",1,"imagen_empresa"],[3,"value"],[2,"text-align","center"],[2,"margin-top","10px"],[3,"interfaceOptions","ngModel","ionChange","ngModelChange"],[4,"ngFor","ngForOf"],["fixed","",2,"text-align","center","color","var(--ion-color-secondary)","font-weight","bold"],[3,"interfaceOptions","ngModel","ngModelChange"],[2,"margin-top","10px",3,"click"],["offset","3","size","3",2,"text-align","start"],[2,"font-weight","bold"],[3,"size",4,"ngFor","ngForOf"],["style","min-width:50%;",4,"ngFor","ngForOf"],[3,"size"],[2,"min-width","50%"],["offset","3","size","3",2,"text-align","start","border-bottom","1px solid black"],[2,"color","var(--ion-color-secondary)","font-weight","bold"],["style","border-bottom: 1px solid;",3,"size",4,"ngFor","ngForOf"],[2,"border-bottom","1px solid",3,"size"],[3,"ngModel","checked","click","ngModelChange"]],template:function(i,o){1&i&&(a.Ob(0,"ion-content"),a.Ob(1,"ion-item",0),a.Ob(2,"ion-label",1),a.kc(3,"Seleccionar un cliente"),a.Nb(),a.Ob(4,"ion-select",2),a.Wb("ionChange",(function(i){return o.sucursalesCliente(i.target.value)})),a.jc(5,b,2,2,"ion-select-option",3),a.Nb(),a.Nb(),a.Ob(6,"ion-item"),a.Ob(7,"ion-label",1),a.kc(8,"Seleccionar una sucursal"),a.Nb(),a.Ob(9,"ion-select",4),a.Wb("ionChange",(function(){return o.selectSucursal()}))("ngModelChange",(function(i){return o.sucursal_elegida=i})),a.jc(10,p,2,2,"ion-select-option",3),a.Nb(),a.Nb(),a.Ob(11,"ion-item"),a.Ob(12,"ion-label",1),a.kc(13,"Seleccionar servicios a ofrecer"),a.Nb(),a.Ob(14,"ion-select",5),a.Wb("ngModelChange",(function(i){return o.servicios_elegidosAux=i}))("ionChange",(function(){return o.serviciosElegidosChange()})),a.jc(15,g,2,2,"ion-select-option",3),a.Nb(),a.Nb(),a.jc(16,h,9,3,"div",6),a.jc(17,v,4,2,"div",7),a.jc(18,z,2,1,"div",6),a.Ob(19,"ion-item"),a.Ob(20,"ion-label",1),a.kc(21,"Elegir una fecha"),a.Nb(),a.Ob(22,"ion-datetime",8),a.Wb("ngModelChange",(function(i){return o.fecha_elegida=i})),a.Nb(),a.Nb(),a.Ob(23,"div",9),a.Ob(24,"ion-button",10),a.Wb("click",(function(){return o.programarVisita()})),a.kc(25,"Agendar"),a.Nb(),a.Nb(),a.Ob(26,"div",11),a.Kb(27,"img",12),a.Nb(),a.Nb()),2&i&&(a.zb(4),a.dc("interfaceOptions",o.custom),a.zb(1),a.dc("ngForOf",o.listado_clientes),a.zb(4),a.dc("interfaceOptions",o.custom)("disabled",null==o.id_cliente_elegido)("ngModel",o.sucursal_elegida),a.zb(1),a.dc("ngForOf",o.listado_sucursales_cliente),a.zb(4),a.dc("interfaceOptions",o.custom)("disabled",null==o.sucursal_elegida&&!o.equiposCargados&&!o.workStationCargados)("ngModel",o.servicios_elegidosAux),a.zb(1),a.dc("ngForOf",o.listado_servicios),a.zb(1),a.dc("ngIf",o.grupoWorkStationElegidos.length>0),a.zb(1),a.dc("ngForOf",o.serviciosElegidos),a.zb(1),a.dc("ngIf",o.show),a.zb(4),a.ec("min",o.fecha_actual),a.ec("value",o.fecha_actual),a.dc("ngModel",o.fecha_elegida)("doneText","Listo")("cancelText","Cancelar")("monthNames",o.monthNames)("dayNames",o.dayNames))},directives:[s.k,s.t,s.u,s.y,s.O,c.i,n.d,n.e,c.j,s.l,s.d,s.z,s.w,s.j,s.i,s.b],styles:["ion-item[_ngcontent-%COMP%]{margin-bottom:10px}.imagen_empresa[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]{width:50%;margin-left:25%}h2[_ngcontent-%COMP%]{color:var(--ion-color-primary)}"]}),i})()}];let x=(()=>{class i{}return i.\u0275mod=a.Hb({type:i}),i.\u0275inj=a.Gb({factory:function(o){return new(o||i)},imports:[[t.h.forChild(w)],t.h]}),i})(),E=(()=>{class i{}return i.\u0275mod=a.Hb({type:i}),i.\u0275inj=a.Gb({factory:function(o){return new(o||i)},imports:[[c.b,n.a,s.G,x]]}),i})()}}]);