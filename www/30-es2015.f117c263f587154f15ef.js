(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"2HF3":function(i,o,e){"use strict";e.r(o),e.d(o,"ProgramarVisitaPageModule",(function(){return z}));var s=e("ofXK"),c=e("3Pt+"),n=e("TEn/"),t=e("tyNb"),r=e("wd/R"),l=e("fXoL"),a=e("89nv"),u=e("u//c");function b(i,o){if(1&i&&(l.Mb(0,"ion-select-option",13),l.ic(1),l.Lb()),2&i){const i=o.$implicit;l.cc("value",i.id_cliente),l.zb(1),l.jc(i.razon_social_cliente)}}function d(i,o){if(1&i&&(l.Mb(0,"ion-select-option",13),l.ic(1),l.Lb()),2&i){const i=o.$implicit;l.cc("value",i.id_sucursal),l.zb(1),l.jc(i.razon_social_sucursal)}}function _(i,o){if(1&i&&(l.Mb(0,"ion-select-option",13),l.ic(1),l.Lb()),2&i){const i=o.$implicit;l.cc("value",i.id_servicio),l.zb(1),l.jc(i.nombre_servicio)}}function p(i,o){if(1&i&&(l.Mb(0,"ion-select-option",13),l.ic(1),l.Lb()),2&i){const i=o.$implicit;l.cc("value",i.id_tecnico),l.zb(1),l.lc("",i.nombre_tecnico," ",i.apellido_tecnico,"")}}function g(i,o){if(1&i){const i=l.Nb();l.Mb(0,"div"),l.Mb(1,"ion-label",16),l.ic(2),l.Lb(),l.Mb(3,"ion-item",17),l.Mb(4,"ion-label",1),l.ic(5,"Seleccionar t\xe9cnico a cargo"),l.Lb(),l.Mb(6,"ion-select",18),l.Ub("ngModelChange",(function(e){return l.ec(i),o.$implicit.tecnico=e})),l.hc(7,p,2,3,"ion-select-option",3),l.Lb(),l.Lb(),l.Lb()}if(2&i){const i=o.$implicit,e=l.Wb(2);l.zb(2),l.jc(i.nombre_equipo),l.zb(4),l.bc("ngModel",i.tecnico),l.zb(1),l.bc("ngForOf",e.listado_tecnicos)}}function h(i,o){if(1&i&&(l.Mb(0,"div",14),l.Mb(1,"h2",14),l.ic(2),l.Lb(),l.hc(3,g,8,3,"div",15),l.Lb()),2&i){const i=o.$implicit;l.zb(2),l.jc(i.nombre_servicio),l.zb(1),l.bc("ngForOf",i.equipos)}}function m(i,o){if(1&i&&(l.Mb(0,"div"),l.Mb(1,"ion-label",16),l.ic(2),l.Lb(),l.Lb()),2&i){const i=o.$implicit;l.zb(2),l.lc("",i.nombre_equipo,": ",i.nombre_servicio,"")}}function v(i,o){if(1&i&&(l.Mb(0,"ion-select-option",13),l.ic(1),l.Lb()),2&i){const i=o.$implicit;l.cc("value",i.id_tecnico),l.zb(1),l.lc("",i.nombre_tecnico," ",i.apellido_tecnico,"")}}function f(i,o){if(1&i){const i=l.Nb();l.Mb(0,"div",14),l.Mb(1,"h2",14),l.ic(2),l.Lb(),l.hc(3,m,3,2,"div",15),l.Mb(4,"ion-item",17),l.Mb(5,"ion-label",1),l.ic(6,"Seleccionar t\xe9cnico a cargo"),l.Lb(),l.Mb(7,"ion-select",18),l.Ub("ngModelChange",(function(e){return l.ec(i),o.$implicit.tecnico=e})),l.hc(8,v,2,3,"ion-select-option",3),l.Lb(),l.Lb(),l.Lb()}if(2&i){const i=o.$implicit,e=l.Wb(2);l.zb(2),l.jc(i.nombre_equipo_grupo),l.zb(1),l.bc("ngForOf",i.equipos),l.zb(4),l.bc("ngModel",i.tecnico),l.zb(1),l.bc("ngForOf",e.listado_tecnicos)}}function q(i,o){if(1&i&&(l.Mb(0,"div"),l.hc(1,f,9,4,"div",6),l.Lb()),2&i){const i=l.Wb();l.zb(1),l.bc("ngForOf",i.grupoWorkStationElegidos)}}const M=[{path:"",component:(()=>{class i{constructor(i,o){this.api=i,this.api_tecnicos=o,this.serviciosConEquipos=[],this.serviciosElegidos=[],this.serviciosParaEnviar=[],this.grupoWorkStation=[],this.grupoWorkStationElegidos=[],this.show=!1,this.servicios_elegidosAux=[],this.id_cliente_elegido=null,this.sucursal_elegida=null,this.dayNames=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],this.monthNames=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}ngOnInit(){this.api.mostrar_servicios().subscribe(i=>{this.listado_servicios=i,this.listado_servicios=this.listado_servicios.result,console.log(this.listado_servicios,"servicios"),this.api.listado_equipos().subscribe(i=>{this.equipos=i.result,console.log(this.equipos,"equipos");for(let o of this.listado_servicios){o.equipos=[];for(let i of this.equipos)i.id_servicio==o.id_servicio&&o.equipos.push(i);o.equipos.length<1&&o.equipos.push({id_equipo:0,id_servicio:o.id_servicio,nombre_equipo:"Servicio principal"})}console.log(this.listado_servicios,"servicios completos")})}),this.api.listado_clientes().subscribe(i=>{this.listado_clientes=i,this.listado_clientes=this.listado_clientes.result,console.log(this.listado_clientes)}),this.api_tecnicos.listado_tecnicos().subscribe(i=>{this.listado_tecnicos=i,this.listado_tecnicos=this.listado_tecnicos.result,console.log(this.listado_tecnicos)},i=>{console.log(i)}),this.fecha_actual=r().format()}sucursalesCliente(i){this.api.informacion_cliente(i).subscribe(o=>{this.listado_sucursales_cliente=o,console.log(o),this.listado_sucursales_cliente=this.listado_sucursales_cliente.result.sucursales.datosSucursal,this.sucursal_elegida=null,this.id_cliente_elegido=i,console.log(this.listado_sucursales_cliente)})}selectSucursal(){this.api.listado_grupoWorkstations(this.sucursal_elegida).subscribe(i=>{var o=0,e=[],s=0,c=!0;"error"==i.status?alert("Ocurrio un error: "+i.message):(i.result.forEach(i=>{i.id_equipo_grupo==o?e[s].equipos.push({id_equipo:i.id_equipo,id_servicio:i.id_servicio,id_sucursal:i.id_sucursal,nombre_equipo:i.nombre_equipo,codigo_qr_equipo:i.codigo_qr_equipo,estado_servicio:i.estado_servicio,nombre_servicio:i.nombre_servicio,qr:i.qr}):(c||s++,o=i.id_equipo_grupo,e.push({nombre_equipo_grupo:i.nombre_equipo_grupo,id_equipo_grupo:i.id_equipo_grupo,equipos:[]}),e[s].equipos.push({id_equipo:i.id_equipo,id_servicio:i.id_servicio,id_sucursal:i.id_sucursal,nombre_equipo:i.nombre_equipo,codigo_qr_equipo:i.codigo_qr_equipo,estado_servicio:i.estado_servicio,nombre_servicio:i.nombre_servicio,qr:i.qr}),c=!1)}),this.grupoWorkStation=e)})}programarVisita(){for(let i of this.serviciosElegidos)for(let o of i.equipos)this.serviciosParaEnviar.push({id_servicio:i.id_servicio,id_tecnico:o.tecnico,id_equipo:o.id_equipo});for(let i of this.grupoWorkStationElegidos)for(let o of i.equipos)this.serviciosParaEnviar.push({id_servicio:o.id_servicio,id_tecnico:i.tecnico,id_equipo:o.id_equipo});console.log(this.serviciosParaEnviar),this.api.crear_visita({id_cliente:this.id_cliente_elegido,id_sucursal:this.sucursal_elegida,servicios:this.serviciosParaEnviar,fecha_visita:this.fecha_elegida}).subscribe(i=>{console.log(i),location.reload()})}serviciosElegidosChange(){this.serviciosElegidos=[];for(let s of this.servicios_elegidosAux)for(let i of this.listado_servicios)i.id_servicio==s&&0==i.qr&&this.serviciosElegidos.push(i);var i=[{nombre_equipo_grupo:null,id_equipo_grupo:null,tecnico:null,equipos:[]}],o=0,e=!0;this.grupoWorkStation.forEach(s=>{s.equipos.forEach(c=>{var n=c.id_servicio.toString();this.servicios_elegidosAux.includes(n)&&(this.checkExist(i,s.nombre_equipo_grupo)||null==i[0].nombre_equipo_grupo?e?(e=!1,console.log("2"),i=[{nombre_equipo_grupo:s.nombre_equipo_grupo,id_equipo_grupo:s.id_equipo_grupo,tecnico:null,equipos:[c]}]):(console.log("1"),o+=1,e=!1,i.push({nombre_equipo_grupo:s.nombre_equipo_grupo,id_equipo_grupo:s.id_equipo_grupo,tecnico:null,equipos:[c]})):(console.log("3"),i[o].equipos.push(c)))})}),this.grupoWorkStationElegidos=i,this.show=!0,null==this.grupoWorkStationElegidos[0].nombre_equipo_grupo&&(this.show=!1),console.log("Servicio elegidos: ",i)}checkExist(i,o){return null==i.find(i=>i.nombre_equipo_grupo==o)}}return i.\u0275fac=function(o){return new(o||i)(l.Jb(a.a),l.Jb(u.a))},i.\u0275cmp=l.Db({type:i,selectors:[["app-programar-visita"]],decls:27,vars:16,consts:[[2,"margin-top","15px"],["fixed","",2,"text-align","center"],[3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled","ngModel","ionChange","ngModelChange"],["multiple","true",3,"disabled","ngModel","ngModelChange","ionChange"],["style","text-align: center;",4,"ngFor","ngForOf"],[4,"ngIf"],["displayFormat","DDDD D MMMM YYYY HH:mm","max","2022",3,"ngModel","doneText","cancelText","monthNames","dayNames","min","value","ngModelChange"],[2,"width","100%","text-align","center"],[3,"click"],[2,"margin-top","25px"],["src","../../../assets/LogoCPA-01.png",1,"imagen_empresa"],[3,"value"],[2,"text-align","center"],[4,"ngFor","ngForOf"],["fixed","",2,"text-align","center","color","var(--ion-color-secondary)","font-weight","bold"],[2,"margin-top","10px"],[3,"ngModel","ngModelChange"]],template:function(i,o){1&i&&(l.Mb(0,"ion-content"),l.Mb(1,"ion-item",0),l.Mb(2,"ion-label",1),l.ic(3,"Seleccionar un cliente"),l.Lb(),l.Mb(4,"ion-select",2),l.Ub("ionChange",(function(i){return o.sucursalesCliente(i.target.value)})),l.hc(5,b,2,2,"ion-select-option",3),l.Lb(),l.Lb(),l.Mb(6,"ion-item"),l.Mb(7,"ion-label",1),l.ic(8,"Seleccionar una sucursal"),l.Lb(),l.Mb(9,"ion-select",4),l.Ub("ionChange",(function(){return o.selectSucursal()}))("ngModelChange",(function(i){return o.sucursal_elegida=i})),l.hc(10,d,2,2,"ion-select-option",3),l.Lb(),l.Lb(),l.Mb(11,"ion-item"),l.Mb(12,"ion-label",1),l.ic(13,"Seleccionar servicios a ofrecer"),l.Lb(),l.Mb(14,"ion-select",5),l.Ub("ngModelChange",(function(i){return o.servicios_elegidosAux=i}))("ionChange",(function(){return o.serviciosElegidosChange()})),l.hc(15,_,2,2,"ion-select-option",3),l.Lb(),l.Lb(),l.hc(16,h,4,2,"div",6),l.hc(17,q,2,1,"div",7),l.Mb(18,"ion-item"),l.Mb(19,"ion-label",1),l.ic(20,"Elegir una fecha"),l.Lb(),l.Mb(21,"ion-datetime",8),l.Ub("ngModelChange",(function(i){return o.fecha_elegida=i})),l.Lb(),l.Lb(),l.Mb(22,"div",9),l.Mb(23,"ion-button",10),l.Ub("click",(function(){return o.programarVisita()})),l.ic(24,"Agendar"),l.Lb(),l.Lb(),l.Mb(25,"div",11),l.Kb(26,"img",12),l.Lb(),l.Lb()),2&i&&(l.zb(5),l.bc("ngForOf",o.listado_clientes),l.zb(4),l.bc("disabled",null==o.id_cliente_elegido)("ngModel",o.sucursal_elegida),l.zb(1),l.bc("ngForOf",o.listado_sucursales_cliente),l.zb(4),l.bc("disabled",null==o.sucursal_elegida)("ngModel",o.servicios_elegidosAux),l.zb(1),l.bc("ngForOf",o.listado_servicios),l.zb(1),l.bc("ngForOf",o.serviciosElegidos),l.zb(1),l.bc("ngIf",o.show),l.zb(4),l.cc("min",o.fecha_actual),l.cc("value",o.fecha_actual),l.bc("ngModel",o.fecha_elegida)("doneText","Listo")("cancelText","Cancelar")("monthNames",o.monthNames)("dayNames",o.dayNames))},directives:[n.g,n.m,n.n,n.q,n.G,s.i,c.d,c.e,s.j,n.h,n.c,n.r],styles:["ion-item[_ngcontent-%COMP%]{margin-bottom:10px}.imagen_empresa[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]{width:50%;margin-left:25%}h2[_ngcontent-%COMP%]{color:var(--ion-color-primary)}"]}),i})()}];let L=(()=>{class i{}return i.\u0275mod=l.Hb({type:i}),i.\u0275inj=l.Gb({factory:function(o){return new(o||i)},imports:[[t.h.forChild(M)],t.h]}),i})(),z=(()=>{class i{}return i.\u0275mod=l.Hb({type:i}),i.\u0275inj=l.Gb({factory:function(o){return new(o||i)},imports:[[s.b,c.a,n.y,L]]}),i})()}}]);