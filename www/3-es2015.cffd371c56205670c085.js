(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+1S5":function(i,s,t){"use strict";t.d(s,"a",(function(){return n}));var e=t("tk/3"),o=t("octk"),r=t("fXoL");let n=(()=>{class i{constructor(i){this.http=i,this.apiDir="http://157.230.90.222:3001",this.requestOptions={headers:new e.c({"Content-Type":"application/json",version:o.a})}}crear_servicio(i){return console.log(i),this.http.post(this.apiDir+"/servicios/crear",i,this.requestOptions)}mostrar_servicios(){return this.http.get(this.apiDir+"/servicios",this.requestOptions)}getZpl(i){return this.http.post(this.apiDir+"/servicios/imprimir",i,this.requestOptions)}alta_producto(i){return this.http.post(this.apiDir+"/productos/crear",i,this.requestOptions)}alta_workstation(i){return this.http.post(this.apiDir+"/servicios/equipos/crear",i,this.requestOptions)}alta_Grupo_workstation(i){return this.http.post(this.apiDir+"/servicios/gruposEquipos/crear",i,this.requestOptions)}eliminar_Grupo_workstation(i){return console.log("delete2",i),this.http.post(this.apiDir+"/servicios/eliminarGrupoEquipos/"+i,null,this.requestOptions)}modificar_Grupo_workstation(i){return this.http.post(this.apiDir+"/servicios/gruposEquipos/crear",i,this.requestOptions)}ver_servicio(i){return this.http.get(this.apiDir+"/servicios/id/"+i,this.requestOptions)}baja_producto(i){return this.http.post(this.apiDir+"/productos/eliminar/"+i,null,this.requestOptions)}baja_servicio(i){return this.http.post(this.apiDir+"/servicios/eliminar/"+i,null,this.requestOptions)}update_servicio(i){return this.http.post(this.apiDir+"/servicios/update",i,this.requestOptions)}baja_opcion(i){return this.http.post(this.apiDir+"/servicios/opcion/delete/",{id:i},this.requestOptions)}ver_opciones_producto(i){return console.log(i),this.http.get(this.apiDir+"/servicios/producto/opciones/"+i,this.requestOptions)}producto_update(i){return console.log(i),this.http.post(this.apiDir+"/productos/actualizar",i,this.requestOptions)}getProductos(){return this.http.get(this.apiDir+"/productos/",this.requestOptions)}}return i.\u0275fac=function(s){return new(s||i)(r.Sb(e.a))},i.\u0275prov=r.Fb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},OAWW:function(i,s,t){"use strict";t.d(s,"a",(function(){return O}));var e=t("mrSG"),o=t("wd/R"),r=t("fXoL"),n=t("89nv"),c=t("u//c"),a=t("jCJ1"),l=t("TEn/"),u=t("3Pt+"),p=t("ofXK");function d(i,s){if(1&i&&(r.Ob(0,"ion-select-option",13),r.kc(1),r.Nb()),2&i){const i=s.$implicit;r.ec("value",i.id_servicio),r.zb(1),r.lc(i.nombre_servicio)}}function b(i,s){if(1&i&&(r.Ob(0,"ion-select-option",13),r.kc(1),r.Nb()),2&i){const i=s.$implicit;r.ec("value",i.id_tecnico),r.zb(1),r.nc("",i.nombre_tecnico," ",i.apellido_tecnico,"")}}function h(i,s){if(1&i){const i=r.Pb();r.Ob(0,"div"),r.Ob(1,"ion-label",16),r.kc(2),r.Nb(),r.Ob(3,"ion-item",17),r.Ob(4,"ion-label",4),r.kc(5,"Seleccionar t\xe9cnico a cargo"),r.Nb(),r.Ob(6,"ion-select",18),r.Wb("ngModelChange",(function(t){return r.gc(i),s.$implicit.tecnico=t})),r.jc(7,b,2,3,"ion-select-option",6),r.Nb(),r.Nb(),r.Nb()}if(2&i){const i=s.$implicit,t=r.Yb(2);r.zb(2),r.lc(i.nombre_equipo),r.zb(4),r.dc("ngModel",i.tecnico),r.zb(1),r.dc("ngForOf",t.listado_tecnicos)}}function v(i,s){if(1&i&&(r.Ob(0,"div",14),r.Ob(1,"h2",14),r.kc(2),r.Nb(),r.jc(3,h,8,3,"div",15),r.Nb()),2&i){const i=s.$implicit;r.zb(2),r.lc(i.nombre_servicio),r.zb(1),r.dc("ngForOf",i.equipos)}}function _(i,s){if(1&i&&(r.Ob(0,"div"),r.Ob(1,"ion-label",16),r.kc(2),r.Nb(),r.Nb()),2&i){const i=s.$implicit;r.zb(2),r.nc("",i.nombre_equipo,": ",i.nombre_servicio,"")}}function g(i,s){if(1&i&&(r.Ob(0,"ion-select-option",13),r.kc(1),r.Nb()),2&i){const i=s.$implicit;r.ec("value",i.id_tecnico),r.zb(1),r.nc("",i.nombre_tecnico," ",i.apellido_tecnico,"")}}function m(i,s){if(1&i){const i=r.Pb();r.Ob(0,"div",14),r.Ob(1,"h2",14),r.kc(2),r.Nb(),r.jc(3,_,3,2,"div",15),r.Ob(4,"ion-item",17),r.Ob(5,"ion-label",4),r.kc(6,"Seleccionar t\xe9cnico a cargo"),r.Nb(),r.Ob(7,"ion-select",18),r.Wb("ngModelChange",(function(t){return r.gc(i),s.$implicit.tecnico=t})),r.jc(8,g,2,3,"ion-select-option",6),r.Nb(),r.Nb(),r.Nb()}if(2&i){const i=s.$implicit,t=r.Yb(2);r.zb(2),r.lc(i.nombre_equipo_grupo),r.zb(1),r.dc("ngForOf",i.equipos),r.zb(4),r.dc("ngModel",i.tecnico),r.zb(1),r.dc("ngForOf",t.listado_tecnicos)}}function f(i,s){if(1&i&&(r.Ob(0,"div"),r.jc(1,m,9,4,"div",7),r.Nb()),2&i){const i=r.Yb();r.zb(1),r.dc("ngForOf",i.grupoWorkStationElegidos)}}let O=(()=>{class i{constructor(i,s,t,e,o,r){this.api=i,this.api_tecnicos=s,this.api_clientes=t,this.navParams=e,this.ModalController=o,this.api_visitas=r,this.serviciosConEquipos=[],this.serviciosElegidos=[],this.serviciosParaEnviar=[],this.grupoWorkStation=[],this.grupoWorkStationElegidos=[],this.show=!1,this.id_visita=this.navParams.get("id_visita"),this.servicios_elegidosAux=[],this.id_cliente_elegido=null,this.sucursal_elegida=null,this.dayNames=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],this.monthNames=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}ngOnInit(){return Object(e.a)(this,void 0,void 0,(function*(){yield this.api.mostrar_servicios().subscribe(i=>{this.listado_servicios=i,this.listado_servicios=this.listado_servicios.result,console.log(this.listado_servicios,"servicios"),this.actualizar_informacion().then(i=>{console.warn(this.sucursal_elegida),this.api.listado_equipos(this.sucursal_elegida).subscribe(i=>{this.equipos=i.result,console.log(this.equipos,"equipos");for(let s of this.listado_servicios){s.equipos=[];for(let i of this.equipos)i.id_servicio==s.id_servicio&&s.equipos.push(i);s.equipos.length<1&&s.equipos.push({id_equipo:0,id_servicio:s.id_servicio,nombre_equipo:"Servicio principal"})}console.log(this.listado_servicios,"servicios completos")})})}),this.api_tecnicos.listado_tecnicos().subscribe(i=>{this.listado_tecnicos=i,this.listado_tecnicos=this.listado_tecnicos.result,console.log(this.listado_tecnicos)},i=>{console.log(i)}),this.fecha_actual=o().format()}))}actualizar_informacion(){return Object(e.a)(this,void 0,void 0,(function*(){yield this.api_clientes.informacion_visita(this.id_visita).then(i=>(this.visita=i,this.visita=this.visita.result,this.id_cliente_elegido=this.visita.visitas.id_cliente,this.sucursal_elegida=this.visita.visitas.id_sucursal,this.sucursalesCliente(this.id_cliente_elegido),this.visita.visitas.id_sucursal))}))}sucursalesCliente(i){this.api.informacion_cliente(i).subscribe(s=>{this.listado_sucursales_cliente=s,console.log(s),this.listado_sucursales_cliente=this.listado_sucursales_cliente.result.sucursales.datosSucursal,this.id_cliente_elegido=i,this.selectSucursal(),console.log(this.listado_sucursales_cliente)})}selectSucursal(){this.api.listado_grupoWorkstations(this.sucursal_elegida).subscribe(i=>{var s=0,t=[],e=0,o=!0;i.result.forEach(i=>{i.id_equipo_grupo==s?t[e].equipos.push({id_equipo:i.id_equipo,id_servicio:i.id_servicio,id_sucursal:i.id_sucursal,nombre_equipo:i.nombre_equipo,codigo_qr_equipo:i.codigo_qr_equipo,estado_servicio:i.estado_servicio,nombre_servicio:i.nombre_servicio,qr:i.qr}):(o||e++,s=i.id_equipo_grupo,t.push({nombre_equipo_grupo:i.nombre_equipo_grupo,id_equipo_grupo:i.id_equipo_grupo,equipos:[]}),t[e].equipos.push({id_equipo:i.id_equipo,id_servicio:i.id_servicio,id_sucursal:i.id_sucursal,nombre_equipo:i.nombre_equipo,codigo_qr_equipo:i.codigo_qr_equipo,estado_servicio:i.estado_servicio,nombre_servicio:i.nombre_servicio,qr:i.qr}),o=!1)}),this.grupoWorkStation=t})}programarVisita(){for(let i of this.serviciosElegidos)for(let s of i.equipos)this.serviciosParaEnviar.push({id_servicio:i.id_servicio,id_tecnico:s.tecnico,id_equipo:s.id_equipo});for(let i of this.grupoWorkStationElegidos)for(let s of i.equipos)this.serviciosParaEnviar.push({id_servicio:s.id_servicio,id_tecnico:i.tecnico,id_equipo:s.id_equipo});console.log(this.serviciosParaEnviar),this.api_visitas.modificar_visita({id_cliente:this.id_cliente_elegido,id_sucursal:this.sucursal_elegida,servicios:this.serviciosParaEnviar,fecha_visita:this.fecha_elegida,id:this.visita.visitas.id_visita}).subscribe(i=>{console.log(i),location.reload()})}serviciosElegidosChange(){this.serviciosElegidos=[];for(let e of this.servicios_elegidosAux)for(let i of this.listado_servicios)i.id_servicio==e&&0==i.qr&&this.serviciosElegidos.push(i);var i=[{nombre_equipo_grupo:null,id_equipo_grupo:null,tecnico:null,equipos:[]}],s=0,t=!0;console.log(this.servicios_elegidosAux),this.grupoWorkStation.forEach(e=>{e.equipos.forEach(o=>{var r=o.id_servicio.toString();this.servicios_elegidosAux.includes(r)&&(this.checkExist(i,e.nombre_equipo_grupo)||null==i[0].nombre_equipo_grupo?t?(t=!1,i=[{nombre_equipo_grupo:e.nombre_equipo_grupo,id_equipo_grupo:e.id_equipo_grupo,tecnico:null,equipos:[o]}]):(console.log("1"),s+=1,t=!1,i.push({nombre_equipo_grupo:e.nombre_equipo_grupo,id_equipo_grupo:e.id_equipo_grupo,tecnico:null,equipos:[o]})):(console.log("3"),i[s].equipos.push(o)))})}),this.grupoWorkStationElegidos=i,this.show=!0,null==this.grupoWorkStationElegidos[0].nombre_equipo_grupo&&(this.show=!1),console.log("Servicio elegidos: ",i)}checkExist(i,s){return null==i.find(i=>i.nombre_equipo_grupo==s)}close(){this.ModalController.dismiss()}}return i.\u0275fac=function(s){return new(s||i)(r.Jb(n.a),r.Jb(c.a),r.Jb(a.a),r.Jb(l.I),r.Jb(l.G),r.Jb(n.a))},i.\u0275cmp=r.Db({type:i,selectors:[["app-modificar-visita"]],decls:24,vars:12,consts:[["color","primary"],["slot","end"],[3,"click"],["name","close-outline"],["fixed","",2,"text-align","center"],["multiple","true",3,"disabled","ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["style","text-align: center;",4,"ngFor","ngForOf"],[4,"ngIf"],["displayFormat","DDDD D MMMM YYYY HH:mm","max","2022",3,"ngModel","doneText","cancelText","monthNames","dayNames","min","value","ngModelChange"],[2,"width","100%","text-align","center"],[2,"margin-top","25px"],["src","../../../assets/LogoCPA-01.png",1,"imagen_empresa"],[3,"value"],[2,"text-align","center"],[4,"ngFor","ngForOf"],["fixed","",2,"text-align","center","color","var(--ion-color-secondary)","font-weight","bold"],[2,"margin-top","10px"],[3,"ngModel","ngModelChange"]],template:function(i,s){1&i&&(r.Ob(0,"ion-header"),r.Ob(1,"ion-toolbar",0),r.Ob(2,"ion-title"),r.kc(3,"Modificar Visita"),r.Nb(),r.Ob(4,"ion-buttons",1),r.Ob(5,"ion-button",2),r.Wb("click",(function(){return s.close()})),r.Kb(6,"ion-icon",3),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Ob(7,"ion-content"),r.Ob(8,"ion-item"),r.Ob(9,"ion-label",4),r.kc(10,"Seleccionar servicios a ofrecer"),r.Nb(),r.Ob(11,"ion-select",5),r.Wb("ngModelChange",(function(i){return s.servicios_elegidosAux=i}))("ionChange",(function(){return s.serviciosElegidosChange()})),r.jc(12,d,2,2,"ion-select-option",6),r.Nb(),r.Nb(),r.jc(13,v,4,2,"div",7),r.jc(14,f,2,1,"div",8),r.Ob(15,"ion-item"),r.Ob(16,"ion-label",4),r.kc(17,"Elegir una fecha"),r.Nb(),r.Ob(18,"ion-datetime",9),r.Wb("ngModelChange",(function(i){return s.fecha_elegida=i})),r.Nb(),r.Nb(),r.Ob(19,"div",10),r.Ob(20,"ion-button",2),r.Wb("click",(function(){return s.programarVisita()})),r.kc(21,"Modificar"),r.Nb(),r.Nb(),r.Ob(22,"div",11),r.Kb(23,"img",12),r.Nb(),r.Nb()),2&i&&(r.zb(11),r.dc("disabled",null==s.sucursal_elegida)("ngModel",s.servicios_elegidosAux),r.zb(1),r.dc("ngForOf",s.listado_servicios),r.zb(1),r.dc("ngForOf",s.serviciosElegidos),r.zb(1),r.dc("ngIf",s.show),r.zb(4),r.ec("min",s.fecha_actual),r.ec("value",s.fecha_actual),r.dc("ngModel",s.fecha_elegida)("doneText","Listo")("cancelText","Cancelar")("monthNames",s.monthNames)("dayNames",s.dayNames))},directives:[l.o,l.D,l.C,l.e,l.d,l.p,l.i,l.r,l.s,l.w,l.M,u.d,u.e,p.i,p.j,l.j,l.x],styles:[""]}),i})()},jCJ1:function(i,s,t){"use strict";t.d(s,"a",(function(){return c}));var e=t("mrSG"),o=t("tk/3"),r=t("octk"),n=t("fXoL");let c=(()=>{class i{constructor(i){this.http=i,this.apiDir="http://157.230.90.222:3001",this.requestOptions={headers:new o.c({"Content-Type":"application/json",version:r.a})}}listado_clientes(){return this.http.get(this.apiDir+"/clientes",this.requestOptions)}informacion_cliente(i){return this.http.get(this.apiDir+"/clientes/id/"+i,this.requestOptions)}alta_sucursal(i){return this.http.post(this.apiDir+"/sucursales/crear",i,this.requestOptions)}informacion_sucursal(i){return this.http.get(this.apiDir+"/sucursales/id/"+i,this.requestOptions)}informacion_visita(i){return Object(e.a)(this,void 0,void 0,(function*(){return(yield this.http.get(this.apiDir+"/visitas/id/"+i,this.requestOptions)).toPromise()}))}listado_workstations(i){return this.http.get(this.apiDir+"/servicios/equipos/sucursal/"+i,this.requestOptions)}listado_grupoWorkstations(i){return this.http.get(this.apiDir+"/servicios/gruposEquipos/sucursal/"+i,this.requestOptions)}borrar_equipo(i){return this.http.post(this.apiDir+"/servicios/eliminarEquipos/"+i,null,this.requestOptions)}listado_productosServicio(i){return this.http.get(this.apiDir+"/productos/idServicio/"+i,this.requestOptions)}cambiar_estado_visita(i,s){console.log(this.apiDir+"/visitas/cambiarEstado",this.requestOptions);var t={id_visita:i,estado:s};return new Promise((i,s)=>{this.http.post(this.apiDir+"/visitas/cambiarEstado",t,this.requestOptions).subscribe(s=>{i(s)},i=>{s(i)})})}eliminar_Grupo_workstation(i){return console.log("delete2",i),this.http.post(this.apiDir+"/servicios/eliminarGrupoEquipos/"+i,this.requestOptions)}subir_planos(i){return this.http.post(this.apiDir+"/planos/crear",i,this.requestOptions)}upload(i,s={}){return new Promise((t,e)=>{this.http.post(this.apiDir+i,s).subscribe(i=>{t(i)},i=>{e(i)})})}ver_sucursal(i){return this.http.get(this.apiDir+"/sucursales/id/"+i,this.requestOptions)}crear_pdf(i){return this.http.post(this.apiDir+"/pdf/create-pdf",i,this.requestOptions)}ver_pdf(i){return this.http.get(this.apiDir+"/pdf/fetch-pdf/"+i,this.requestOptions)}modificar_cliente(i){return this.http.post(this.apiDir+"/clientes/actualizar",i,this.requestOptions)}subir_logo_cliente(i){return this.http.post(this.apiDir+"/clientes/actualizarLogo",i,this.requestOptions)}eliminar_Logo_Cliente(i){return this.http.post(this.apiDir+"/clientes/eliminarLogo",i,this.requestOptions)}eliminar_cliente(i){return this.http.post(this.apiDir+"/clientes/eliminar/"+i,this.requestOptions)}eliminar_sucursal(i){return this.http.post(this.apiDir+"/sucursales/eliminar/"+i,this.requestOptions)}eliminar_plano(i){return this.http.post(this.apiDir+"/planos/eliminar/"+i,this.requestOptions)}modificar_sucursal(i){return this.http.post(this.apiDir+"/sucursales/actualizar",i,this.requestOptions)}}return i.\u0275fac=function(s){return new(s||i)(n.Sb(o.a))},i.\u0275prov=n.Fb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},lENo:function(i,s,t){"use strict";t.d(s,"a",(function(){return E}));var e=t("mrSG"),o=t("fXoL"),r=t("TEn/"),n=t("+1S5"),c=t("89nv"),a=t("ofXK"),l=t("3Pt+");function u(i,s){if(1&i&&(o.Ob(0,"ion-select-option",7),o.kc(1),o.Nb()),2&i){const i=s.$implicit;o.dc("value",i.name),o.zb(1),o.lc(i.name)}}function p(i,s){if(1&i){const i=o.Pb();o.Ob(0,"div"),o.Ob(1,"ion-item"),o.Ob(2,"ion-label"),o.kc(3),o.Nb(),o.Ob(4,"ion-select",5),o.Wb("ngModelChange",(function(s){o.gc(i);const t=o.Yb().index;return o.Yb(2).respuestas[t].respuesta=s})),o.jc(5,u,2,2,"ion-select-option",6),o.Nb(),o.Nb(),o.Nb()}if(2&i){const i=o.Yb(),s=i.$implicit,t=i.index,e=o.Yb(2);o.zb(3),o.lc(s.nombreCampo),o.zb(1),o.dc("ngModel",e.respuestas[t].respuesta),o.zb(1),o.dc("ngForOf",s.opciones)}}function d(i,s){if(1&i&&(o.Ob(0,"ion-select-option",7),o.kc(1),o.Nb()),2&i){const i=s.$implicit;o.dc("value",i.name),o.zb(1),o.lc(i.name)}}function b(i,s){if(1&i){const i=o.Pb();o.Ob(0,"div"),o.Ob(1,"ion-item"),o.Ob(2,"ion-label"),o.kc(3,"Otros: "),o.Nb(),o.Ob(4,"ion-input",9),o.Wb("ngModelChange",(function(s){return o.gc(i),o.Yb(4).otros=s})),o.Nb(),o.Nb(),o.Nb()}if(2&i){const i=o.Yb(4);o.zb(4),o.dc("ngModel",i.otros)}}function h(i,s){if(1&i){const i=o.Pb();o.Ob(0,"div"),o.Ob(1,"ion-item"),o.Ob(2,"ion-label"),o.kc(3),o.Nb(),o.Ob(4,"ion-select",8),o.Wb("ngModelChange",(function(s){o.gc(i);const t=o.Yb().index;return o.Yb(2).respuestas[t].respuesta=s})),o.jc(5,d,2,2,"ion-select-option",6),o.Nb(),o.Nb(),o.jc(6,b,5,1,"div",1),o.Nb()}if(2&i){const i=o.Yb(),s=i.$implicit,t=i.index,e=o.Yb(2);o.zb(3),o.lc(s.nombreCampo),o.zb(1),o.dc("ngModel",e.respuestas[t].respuesta),o.zb(1),o.dc("ngForOf",s.opciones),o.zb(1),o.dc("ngIf",("multiple"==s.tipoCampo||"Multiple"==s.tipoCampo)&&30==s.id_campo&&e.mostrarOtros())}}function v(i,s){if(1&i){const i=o.Pb();o.Ob(0,"div"),o.Ob(1,"ion-item"),o.Ob(2,"ion-label"),o.kc(3),o.Nb(),o.Ob(4,"ion-input",9),o.Wb("ngModelChange",(function(s){o.gc(i);const t=o.Yb().index;return o.Yb(2).respuestas[t].respuesta=s})),o.Nb(),o.Nb(),o.Nb()}if(2&i){const i=o.Yb(),s=i.$implicit,t=i.index,e=o.Yb(2);o.zb(3),o.lc(s.nombreCampo),o.zb(1),o.dc("ngModel",e.respuestas[t].respuesta)}}function _(i,s){if(1&i&&(o.Ob(0,"div"),o.jc(1,p,6,3,"div",1),o.jc(2,h,7,4,"div",1),o.jc(3,v,5,2,"div",1),o.Nb()),2&i){const i=s.$implicit;o.zb(1),o.dc("ngIf","Select"==i.tipoCampo||"select"==i.tipoCampo),o.zb(1),o.dc("ngIf","multiple"==i.tipoCampo||"Multiple"==i.tipoCampo),o.zb(1),o.dc("ngIf","input"==i.tipoCampo||"Input"==i.tipoCampo)}}function g(i,s){if(1&i&&(o.Ob(0,"div"),o.jc(1,_,4,3,"div",4),o.Nb()),2&i){const i=o.Yb();o.zb(1),o.dc("ngForOf",i.servicio.formulario)}}let m=(()=>{class i{constructor(i,s,t,e){this.navParams=i,this.apiServicios=s,this.apiVisitas=t,this.modalcontroller=e}ngOnInit(){this.id_servicio=this.navParams.get("id_servicio"),this.id_visita=this.navParams.get("id_visita"),this.id_formulario=this.navParams.get("id_formulario"),this.navParams.get("equipo")&&(this.equipo=this.navParams.get("equipo")),console.log(this.id_formulario),this.apiVisitas.getRespuestas(this.id_formulario).then(i=>{this.respuestas=i.respuestas,console.log(this.respuestas),this.apiServicios.ver_servicio(this.id_servicio).subscribe(i=>{this.servicio=i.result;for(let n=0;n<this.servicio.formulario.length;n++){const i=this.servicio.formulario[n];if("multiple"==i.tipoCampo.toLowerCase()&&30==i.id_campo){var s=this.respuestas[n].respuesta.split(" - ")[this.respuestas[n].respuesta.split(" - ").length-1];i.opciones.find(i=>i.name==s)||(this.otros=s);var t=this.respuestas[n].respuesta;this.respuestas[n].respuesta=[];for(let i=0;i<t.split(" - ").length;i++){const s=t.split(" - ")[i];""!=s&&(this.respuestas[n].respuesta[i]=s)}i.opciones.find(i=>i.name==this.respuestas[n].respuesta[this.respuestas[n].respuesta.length-1])||(this.respuestas[n].respuesta[this.respuestas[n].respuesta.length-1]="Otros")}if("multiple"==i.tipoCampo.toLowerCase()&&30!=i.id_campo){t=this.respuestas[n].respuesta,this.respuestas[n].respuesta=[];for(let i=0;i<t.split(" - ").length;i++){const s=t.split(" - ")[i];""!=s&&(this.respuestas[n].respuesta[i]=s)}}}console.log(this.servicio);var e=this.respuestas.findIndex(i=>55==i.id_campo);this.respuestas[e]&&(this.respuestas[e].respuesta=this.servicio.listaProductos.find(i=>i.id_producto==this.respuestas[e].respuesta).tipo_producto);var o=this.respuestas.findIndex(i=>70==i.id_campo);if(this.respuestas[o]){t=this.respuestas[o];var r=[];for(let i=0;i<this.respuestas[o].respuesta.length;i++)r.push(this.servicio.listaProductos.find(s=>s.id_producto==this.respuestas[o].respuesta[i]).tipo_producto);this.respuestas[o].respuesta=r}console.log(this.respuestas)})}).catch(i=>{console.warn(i)})}modalDissmiss(){this.modalcontroller.dismiss()}prueba1(i){console.log(i)}prueba(){console.log(this.respuestas)}cambio(i,s){this.respuestas[s].respuesta=i.toString()}guardar(){if(this.respuestas.find(i=>30==i.id_campo)){var i=this.respuestas.findIndex(i=>30==i.id_campo);this.respuestas[i].respuesta.includes("Otros")&&this.respuestas[i].respuesta.splice(this.respuestas[i].respuesta.length-1,1,this.otros)}for(let o=0;o<this.servicio.formulario.length;o++){const i=this.servicio.formulario[o];if("multiple"==i.tipoCampo.toLowerCase()){var s,t=this.respuestas[o].respuesta;for(let i=0;i<t.length;i++){const e=t[i];console.log(e),0==i?(console.log("5"),s=e):(console.log("6"),s=s+" - "+e)}this.respuestas[o].respuesta=s}var e;if("Tipo de producto"==i.nombreCampo){for(let i=0;i<this.respuestas[o].respuesta.split(" - ").length;i++){const s=this.respuestas[o].respuesta.split(" - ")[i];console.log(s),(t=this.servicio.listaProductos.find(i=>i.nombre_producto.toLowerCase()==s.toLowerCase()))||(t=this.servicio.listaProductos.find(i=>i.tipo_producto.toLowerCase()==s.toLowerCase())),e=0==i?t.id_producto.toString():e+" - "+t.id_producto.toString()}this.respuestas[o].respuesta=e}}this.apiVisitas.cambiarRespuestas(this.respuestas).then(i=>{this.modalDissmiss()})}mostrarOtros(){return this.respuestas.find(i=>30==i.id_campo).respuesta.includes("Otros")}}return i.\u0275fac=function(s){return new(s||i)(o.Jb(r.I),o.Jb(n.a),o.Jb(c.a),o.Jb(r.G))},i.\u0275cmp=o.Db({type:i,selectors:[["app-editar-visita"]],decls:15,vars:2,consts:[["color","primary",2,"text-align","center"],[4,"ngIf"],[1,"ion-text-center"],[1,"button",2,"width","50%",3,"click"],[4,"ngFor","ngForOf"],["mode","ios",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["multiple","","mode","ios",3,"ngModel","ngModelChange"],["mode","ios",2,"margin-left","10px",3,"ngModel","ngModelChange"]],template:function(i,s){1&i&&(o.Ob(0,"ion-header"),o.Ob(1,"ion-toolbar",0),o.Ob(2,"ion-title"),o.kc(3),o.Nb(),o.Nb(),o.Nb(),o.Ob(4,"ion-content"),o.jc(5,g,2,1,"div",1),o.Ob(6,"ion-row"),o.Ob(7,"ion-col",2),o.Ob(8,"div"),o.Ob(9,"ion-button",3),o.Wb("click",(function(){return s.modalDissmiss()})),o.kc(10,"Volver"),o.Nb(),o.Nb(),o.Nb(),o.Ob(11,"ion-col",2),o.Ob(12,"div"),o.Ob(13,"ion-button",3),o.Wb("click",(function(){return s.guardar()})),o.kc(14,"Guardar"),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Nb()),2&i&&(o.zb(3),o.lc(s.equipo?s.equipo:null==s.servicio?null:s.servicio.nombreDelServicio),o.zb(2),o.dc("ngIf",s.servicio))},directives:[r.o,r.D,r.C,r.i,a.j,r.u,r.h,r.d,a.i,r.r,r.s,r.w,r.M,l.d,l.e,r.x,r.q,r.N],styles:[""]}),i})();function f(i,s){if(1&i){const i=o.Pb();o.Ob(0,"ion-item",4),o.Wb("click",(function(){o.gc(i);const t=s.$implicit;return o.Yb().editarServicio(t.id_formulario,t.nombre_equipo)})),o.Ob(1,"ion-label"),o.kc(2),o.Nb(),o.Nb()}if(2&i){const i=s.$implicit;o.zb(2),o.lc(i.nombre_equipo)}}let O=(()=>{class i{constructor(i,s,t,e){this.navParams=i,this.apiServicios=s,this.apiVisitas=t,this.modalController=e}ngOnInit(){this.id_servicio=this.navParams.get("id_servicio");var i=[];new Promise((s,t)=>{for(let e=0;e<this.navParams.get("visita").servicios.length;e++){const t=this.navParams.get("visita").servicios[e];20!=t.id_servicio&&22!=t.id_servicio||t.id_servicio!=this.id_servicio||(this.apiVisitas.getRespuestas(t.id_formulario).then(i=>{t.respuestas=i.respuestas,this.apiVisitas.getEquipo(t.respuestas[0].id_equipo).then(i=>{i.result[0]&&(t.nombre_equipo=i.result[0].nombre_equipo)})}).catch(i=>{console.error(i)}),i.push(t)),e==this.navParams.get("visita").servicios.length-1&&s("")}}).then(()=>{this.servicios=i,console.log(this.servicios)}).catch(i=>{console.error(i)})}ngOnDestroy(){}editarServicio(i,s){return Object(e.a)(this,void 0,void 0,(function*(){const t=yield this.modalController.create({component:m,componentProps:{id_servicio:this.id_servicio,id_visita:this.navParams.get("visita").id_visita,id_formulario:i,equipo:s}});yield t.present()}))}modalDismiss(){this.modalController.dismiss()}}return i.\u0275fac=function(s){return new(s||i)(o.Jb(r.I),o.Jb(n.a),o.Jb(c.a),o.Jb(r.G))},i.\u0275cmp=o.Db({type:i,selectors:[["app-ver-servicio-visita"]],decls:11,vars:2,consts:[["color","primary"],[3,"click",4,"ngFor","ngForOf"],[1,"ion-text-center"],[1,"button",2,"width","50%",3,"click"],[3,"click"]],template:function(i,s){1&i&&(o.Ob(0,"ion-header"),o.Ob(1,"ion-toolbar",0),o.Ob(2,"ion-title"),o.kc(3),o.Nb(),o.Nb(),o.Nb(),o.Ob(4,"ion-content"),o.jc(5,f,3,1,"ion-item",1),o.Ob(6,"ion-row"),o.Ob(7,"ion-col",2),o.Ob(8,"div"),o.Ob(9,"ion-button",3),o.Wb("click",(function(){return s.modalDismiss()})),o.kc(10,"Volver"),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Nb()),2&i&&(o.zb(3),o.lc(s.servicios?s.servicios[0].nombre_servicio:null),o.zb(2),o.dc("ngForOf",s.servicios))},directives:[r.o,r.D,r.C,r.i,a.i,r.u,r.h,r.d,r.r,r.s],styles:[""]}),i})();var q=t("OAWW"),N=t("jCJ1");function k(i,s){1&i&&(o.Ob(0,"div",7),o.Kb(1,"ion-spinner"),o.Nb())}function C(i,s){if(1&i&&(o.Ob(0,"div"),o.Ob(1,"ion-item",8),o.Ob(2,"ion-label"),o.Ob(3,"b"),o.kc(4,"Fecha de concluida la visita:"),o.Nb(),o.kc(5),o.Zb(6,"date"),o.Nb(),o.Nb(),o.Nb()),2&i){const i=o.Yb(2);o.zb(5),o.mc(" ",o.ac(6,1,i.visita.visitas.horario_salida,"dd/MM/yyyy hh:mm"),"")}}function D(i,s){if(1&i&&(o.Ob(0,"div"),o.Ob(1,"ion-item"),o.Ob(2,"ion-label"),o.Ob(3,"b"),o.kc(4,"Fecha estimada de la visita:"),o.Nb(),o.kc(5),o.Zb(6,"date"),o.Nb(),o.Nb(),o.Nb()),2&i){const i=o.Yb(2);o.zb(5),o.mc(" ",o.ac(6,1,i.visita.visitas.fecha_visita,"dd/MM/yyyy hh:mm"),"")}}function z(i,s){if(1&i){const i=o.Pb();o.Ob(0,"ion-icon",13),o.Wb("click",(function(){o.gc(i);const s=o.Yb().$implicit;return o.Yb(2).editarServicio(s.id_servicio,s.id_formulario)})),o.Nb()}}function P(i,s){if(1&i&&(o.Ob(0,"div",10),o.Kb(1,"ion-icon",11),o.kc(2),o.jc(3,z,1,0,"ion-icon",12),o.Nb()),2&i){const i=s.$implicit,t=o.Yb(2);o.zb(2),o.mc(" ",i.nombre_servicio," "),o.zb(1),o.dc("ngIf","finalizada"==t.visita.visitas.estado_visitas)}}function y(i,s){if(1&i){const i=o.Pb();o.Ob(0,"div"),o.Ob(1,"ion-button",14),o.Wb("click",(function(){return o.gc(i),o.Yb(3).generar_pdf()})),o.kc(2,"Generar PDF"),o.Nb(),o.Nb()}}function M(i,s){if(1&i){const i=o.Pb();o.Ob(0,"div"),o.Ob(1,"ion-button",15),o.Wb("click",(function(){return o.gc(i),o.Yb(3).ver_pdf()})),o.kc(2,"Ver PDF"),o.Nb(),o.Nb()}}function j(i,s){if(1&i){const i=o.Pb();o.Ob(0,"div"),o.Ob(1,"ion-button",14),o.Wb("click",(function(){return o.gc(i),o.Yb(3).generar_pdf()})),o.kc(2,"Volver a generar PDF"),o.Nb(),o.Nb()}}function w(i,s){if(1&i&&(o.Ob(0,"div"),o.jc(1,y,3,0,"div",5),o.jc(2,M,3,0,"div",5),o.jc(3,j,3,0,"div",5),o.Nb()),2&i){const i=o.Yb(2);o.zb(1),o.dc("ngIf",!i.pdf_generado&&0==i.visita.visitas.pdfGenerado),o.zb(1),o.dc("ngIf",i.pdf_generado||1==i.visita.visitas.pdfGenerado),o.zb(1),o.dc("ngIf",i.pdf_generado||1==i.visita.visitas.pdfGenerado)}}function x(i,s){if(1&i){const i=o.Pb();o.Ob(0,"div"),o.Ob(1,"ion-button",14),o.Wb("click",(function(){return o.gc(i),o.Yb(2).modificar_visita()})),o.kc(2,"Modificar visita"),o.Nb(),o.Nb()}}function S(i,s){if(1&i&&(o.Ob(0,"div"),o.jc(1,C,7,4,"div",5),o.jc(2,D,7,4,"div",5),o.Ob(3,"ion-item",8),o.Ob(4,"ion-label"),o.Ob(5,"b"),o.kc(6,"Cliente:"),o.Nb(),o.kc(7),o.Nb(),o.Nb(),o.Ob(8,"ion-item",8),o.Ob(9,"ion-label"),o.Ob(10,"b"),o.kc(11,"Sucursal:"),o.Nb(),o.kc(12),o.Nb(),o.Nb(),o.Ob(13,"ion-item",8),o.Ob(14,"ion-label"),o.Ob(15,"b"),o.kc(16,"Servicios ofrecidos:"),o.Nb(),o.jc(17,P,4,2,"div",9),o.Nb(),o.Nb(),o.jc(18,w,4,3,"div",5),o.jc(19,x,3,0,"div",5),o.Nb()),2&i){const i=o.Yb();o.zb(1),o.dc("ngIf","NULL"!=i.visita.visitas.horario_salida),o.zb(1),o.dc("ngIf","NULL"==i.visita.visitas.horario_salida),o.zb(5),o.mc(" ",i.visita.visitas.razon_social_cliente,""),o.zb(5),o.mc(" ",i.visita.visitas.razon_social_sucursal,""),o.zb(5),o.dc("ngForOf",i.visita.servicios2),o.zb(1),o.dc("ngIf","NULL"!=i.visita.visitas.horario_salida),o.zb(1),o.dc("ngIf","NULL"==i.visita.visitas.horario_salida)}}let E=(()=>{class i{constructor(i,s,t,e){this.navParams=i,this.api_visitas=s,this.modalController=t,this.loadingController=e,this.id_visita=this.navParams.get("id_visita"),this.pdf_generado=!1}ngOnInit(){this.actualizar_informacion()}generar_pdf(){return Object(e.a)(this,void 0,void 0,(function*(){var i=yield this.loadingController.create({message:"Generando PDF"});i.present(),console.log(this.id_visita),this.api_visitas.crear_pdf({id_visita:this.id_visita}).subscribe(s=>{console.log(s),this.pdf_generado=!0,i.dismiss()},s=>{console.log(s),i.dismiss()})}))}ver_pdf(){this.api_visitas.ver_pdf(this.id_visita).subscribe(i=>{this.url=i,console.log(this.url.url),window.open(this.url.url,"_blank").focus()},i=>{console.log(i)})}close(){this.modalController.dismiss()}actualizar_informacion(){this.api_visitas.informacion_visita(this.id_visita).then(i=>{var s;if(this.visita=i,this.visita=this.visita.result,console.log(this.visita),this.visita){this.visita.servicios2=[];for(let i of this.visita.servicios)(null===(s=this.visita)||void 0===s?void 0:s.servicios2.find(s=>s.nombre_servicio==i.nombre_servicio))||this.visita.servicios2.push(22==i.id_servicio||20==i.id_servicio?{nombre_servicio:i.nombre_servicio,id_servicio:i.id_servicio,id_formulario:null}:i)}})}modificar_visita(){return Object(e.a)(this,void 0,void 0,(function*(){const i=yield this.modalController.create({component:q.a,cssClass:"my-custom-class",componentProps:{id_visita:this.id_visita}});return i.onDidDismiss().then(i=>{this.actualizar_informacion()}),yield i.present()}))}editarServicio(i,s){return Object(e.a)(this,void 0,void 0,(function*(){if(s){const t=yield this.modalController.create({component:m,componentProps:{id_servicio:i,id_visita:this.id_visita,id_formulario:s}});yield t.present()}else{const s=yield this.modalController.create({component:O,componentProps:{id_servicio:i,visita:this.visita}});yield s.present()}}))}}return i.\u0275fac=function(s){return new(s||i)(o.Jb(r.I),o.Jb(N.a),o.Jb(r.G),o.Jb(r.F))},i.\u0275cmp=o.Db({type:i,selectors:[["app-ver-visita"]],decls:12,vars:2,consts:[["color","primary",2,"text-align","center"],["slot","end"],[3,"click"],["name","close-outline"],["style","text-align: center;",4,"ngIf"],[4,"ngIf"],["src","../../../assets/LogoCPA-01.png",1,"imagen_empresa"],[2,"text-align","center"],["lines","full"],["style","margin-left:10px; margin-top: 10px",4,"ngFor","ngForOf"],[2,"margin-left","10px","margin-top","10px"],["name","document-outline","color","primary"],["name","create-outline","style","cursor: pointer;",3,"click",4,"ngIf"],["name","create-outline",2,"cursor","pointer",3,"click"],["expand","full",3,"click"],["expand","full","color","success",3,"click"]],template:function(i,s){1&i&&(o.Ob(0,"ion-header"),o.Ob(1,"ion-toolbar",0),o.Ob(2,"ion-title"),o.kc(3,"visita"),o.Nb(),o.Ob(4,"ion-buttons",1),o.Ob(5,"ion-button",2),o.Wb("click",(function(){return s.close()})),o.Kb(6,"ion-icon",3),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Ob(7,"ion-content"),o.jc(8,k,2,0,"div",4),o.jc(9,S,20,7,"div",5),o.Ob(10,"div"),o.Kb(11,"img",6),o.Nb(),o.Nb()),2&i&&(o.zb(8),o.dc("ngIf",!s.visita),o.zb(1),o.dc("ngIf",s.visita))},directives:[r.o,r.D,r.C,r.e,r.d,r.p,r.i,a.j,r.y,r.r,r.s,a.i],pipes:[a.d],styles:[""]}),i})()}}]);